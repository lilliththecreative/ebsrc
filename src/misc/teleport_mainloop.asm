
TELEPORT_MAINLOOP:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_INT32
	STACK_RESERVE_INT32
	END_STACK_VARS
	JSL STOP_MUSIC
	JSL WAIT_UNTIL_NEXT_FRAME
	JSR TELEPORT_FREEZEOBJECTS
	LDA #1
	STA UNREAD_7E5DBA
	MOVE_INT_CONSTANT 0, PSI_TELEPORT_SPEED
	STZ PSI_TELEPORT_STATE
	JSL UNKNOWN_C07C5B
	JSR UNKNOWN_C0DE46
	LDA PSI_TELEPORT_STYLE
	CMP #TELEPORT_STYLE::PSI_ALPHA
	BEQ @STYLE_1_OR_5
	CMP #TELEPORT_STYLE::UNKNOWN
	BEQ @STYLE_1_OR_5
	CMP #TELEPORT_STYLE::PSI_BETA
	BEQ @STYLE_2
	CMP #TELEPORT_STYLE::INSTANT
	BEQ @STYLE_3
	CMP #TELEPORT_STYLE::PSI_BETTER
	BEQ @STYLE_4
	BRA @STYLE_OTHER
@STYLE_1_OR_5:
	LOADPTR UNKNOWN_C0E28F, @LOCAL00
	LOADPTR UNKNOWN_C0E3C1, @LOCAL01
	LDA #23
	JSL SET_PARTY_TICK_CALLBACKS
	BRA @STYLE_OTHER
@STYLE_2:
	LOADPTR UNKNOWN_C0E516, @LOCAL00
	LOADPTR UNKNOWN_C0E3C1, @LOCAL01
	LDA #23
	JSL SET_PARTY_TICK_CALLBACKS
	BRA @STYLE_OTHER
@STYLE_3:
	LDA #1
	STA PSI_TELEPORT_STATE
	BRA @STYLE_OTHER
@STYLE_4:
	LOADPTR UNKNOWN_C0E516, @LOCAL00
	LOADPTR UNKNOWN_C0E3C1, @LOCAL01
	LDA #23
	JSL SET_PARTY_TICK_CALLBACKS
@STYLE_OTHER:
	LDA PSI_TELEPORT_STYLE
	CMP #TELEPORT_STYLE::INSTANT
	BEQ @UNKNOWN6
	LDA #MUSIC::TELEPORT_OUT
	JSL CHANGE_MUSIC
	BRA @UNKNOWN6
@UNKNOWN5:
	JSL OAM_CLEAR
	JSL RUN_ACTIONSCRIPT_FRAME
	JSR TELEPORT_FREEZEOBJECTS2
	JSL UPDATE_SCREEN
	JSL WAIT_UNTIL_NEXT_FRAME
@UNKNOWN6:
	LDA PSI_TELEPORT_STATE
	BEQ @UNKNOWN5
	LDA PSI_TELEPORT_STATE
	CMP #1
	BEQ @UNKNOWN7
	CMP #2
	BEQ @UNKNOWN8
	BRA @UNKNOWN9
@UNKNOWN7:
	JSR UNKNOWN_C0E815
	JSL UNKNOWN_C0DD79
	JSR UNKNOWN_C0E897
	LDA PSI_TELEPORT_STYLE
	CMP #TELEPORT_STYLE::UNKNOWN
	BNE @UNKNOWN9
	LOADPTR MSG_EVT_MASTER_TLPT, @LOCAL00
	JSL UNKNOWN_C46881
	BRA @UNKNOWN9
@UNKNOWN8:
	JSR UNKNOWN_C0E9BA
	LDA #10
	JSL UNKNOWN_C0DD2C
@UNKNOWN9:
	LOADPTR UNKNOWN_C05200, @LOCAL00
	LOADPTR UNKNOWN_C04D78, @LOCAL01
	LDA #23
	JSL SET_PARTY_TICK_CALLBACKS
	JSR UNKNOWN_C0DE7C
	JSL UNKNOWN_C09451
	STZ UNREAD_7E5DBA
	MOVE_INT_CONSTANT NULL, PSI_TELEPORT_SPEED
	STZ PLAYER_INTANGIBILITY_FRAMES
	STZ PSI_TELEPORT_DESTINATION
	END_C_FUNCTION
