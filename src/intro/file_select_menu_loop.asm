
FILE_MENU_LOOP:
	BEGIN_C_FUNCTION
	STACK_RESERVE_VARS
	STACK_RESERVE_INT32
	STACK_RESERVE_INT32
	STACK_RESERVE_INT32
.IF !.DEFINED(PROTOTYPE19950327)
	STACK_RESERVE_INT16
.ENDIF
	STACK_RESERVE_INT16 "LOCAL04"
	STACK_RESERVE_INT16 "LOCAL05"
	STACK_RESERVE_INT16 "LOCAL06"
	STACK_RESERVE_INT16 "LOCAL07"
	STACK_RESERVE_INT16 "LOCAL08"
	END_STACK_VARS
.IF .DEFINED(PROTOTYPE19950327)
	@LOCAL03T := @LOCAL04
	@LOCAL06ALT := @LOCAL08
	@LOCAL08ALT := @LOCAL05
	@LOCAL08ALT2 := @LOCAL06
.ELSE
	@LOCAL03T := @LOCAL03
	@LOCAL06ALT := @LOCAL06
	@LOCAL08ALT := @LOCAL08
	@LOCAL08ALT2 := @LOCAL08
.ENDIF
@UNKNOWN0:
	JSR SET_INSTANT_PRINTING
	LDA #0
	JSR FILE_SELECT_MENU
	TAX
	DEX
	LDA SAVE_FILES_PRESENT,X
	AND #$00FF
	BEQL @EMPTY_FILE_SELECTED
@VALID_FILE_SELECTED:
	JSR UNKNOWN_C1F07E
	CMP #0
	BEQ @MENU_B_PRESSED
	CMP #1
	BEQ @MENU_STARTGAME_SELECTED
	CMP #2
	BEQ @MENU_COPY_SELECTED
	CMP #3
	BEQ @MENU_DELETE_SELECTED
	CMP #4
	BEQ @MENU_SETUP_SELECTED
	BRA @MENU_OTHER_SELECTED
@MENU_B_PRESSED:
	JSR CLOSE_FOCUS_WINDOW
	BRA @UNKNOWN0
@MENU_STARTGAME_SELECTED:
	JSL UNKNOWN_C064D4
	JSL RELOAD_HOTSPOTS
	LDA GAME_STATE+game_state::leader_x_coord
	STA RESPAWN_X
	LDA GAME_STATE+game_state::leader_y_coord
	STA RESPAWN_Y
	JMP @UNKNOWN59
@MENU_COPY_SELECTED:
	JSR UNKNOWN_C1F14F
	CMP #0
	BEQ @VALID_FILE_SELECTED
	BRA @MENU_OTHER_SELECTED
@MENU_DELETE_SELECTED:
	JSR UNKNOWN_C1F2A8
	CMP #0
	BEQ @VALID_FILE_SELECTED
	BRA @MENU_OTHER_SELECTED
@MENU_SETUP_SELECTED:
	JSL OPEN_TEXT_SPEED_MENU
@UNKNOWN7:
	LDA #0
	JSL UNKNOWN_C1F497
	CMP #0
	BNE @MENU_SETUP_SELECTED2
	LDA #WINDOW::FILE_SELECT_TEXT_SPEED
	JSR CLOSE_WINDOW
	BRA @VALID_FILE_SELECTED
@MENU_SETUP_SELECTED2:
	JSR OPEN_SOUND_MENU
@UNKNOWN9:
	LDA #0
	JSR UNKNOWN_C1F616
	CMP #0
	BNE @MENU_SETUP_SELECTED3
	LDA #WINDOW::FILE_SELECT_MUSIC_MODE
	JSR CLOSE_WINDOW
	BRA @UNKNOWN7
@MENU_SETUP_SELECTED3:
	JSR OPEN_FLAVOUR_MENU
	CMP #0
	BNE @MENU_OTHER_SELECTED
	LDA #WINDOW::FILE_SELECT_FLAVOUR_CHOICE
	JSR CLOSE_WINDOW
	BRA @UNKNOWN9
@MENU_OTHER_SELECTED:
	JSR UNKNOWN_C1008E
	JMP @UNKNOWN0
@EMPTY_FILE_SELECTED:
	JSL OPEN_TEXT_SPEED_MENU
@UNKNOWN13:
	LDA #0
	JSL UNKNOWN_C1F497
	CMP #0
	BNE @UNKNOWN14
	LDA #WINDOW::FILE_SELECT_TEXT_SPEED
	JSR CLOSE_WINDOW
	JMP @UNKNOWN0
@UNKNOWN14:
	JSR OPEN_SOUND_MENU
@UNKNOWN15:
	LDA #0
	JSR UNKNOWN_C1F616
	CMP #0
	BNE @UNKNOWN16
	LDA #WINDOW::FILE_SELECT_MUSIC_MODE
	JSR CLOSE_WINDOW
	BRA @UNKNOWN13
@UNKNOWN16:
	JSR OPEN_FLAVOUR_MENU
	CMP #0
	BNE @CHANGE_TO_NAMING_SCREEN_MUSIC
	LDA #WINDOW::FILE_SELECT_FLAVOUR_CHOICE
	JSR CLOSE_WINDOW
	BRA @UNKNOWN15
@CHANGE_TO_NAMING_SCREEN_MUSIC:
	LDA #MUSIC::NAMING_SCREEN
	JSL CHANGE_MUSIC
@UNKNOWN18:
	JSR UNKNOWN_C1008E
	LDA #0
	STA @VIRTUAL04
	STA @LOCAL08
	JMP @UNKNOWN31
@UNKNOWN19:
	LDA @VIRTUAL04
	CMP #$FFFF
	BNE @UNKNOWN20
	JSR UNKNOWN_C1008E
	LDA #1
	JSR FILE_SELECT_MENU
	LDA #1
	JSL UNKNOWN_C1F497
	LDA #1
	JSR UNKNOWN_C1F616
	LDA #MUSIC::SETUP_SCREEN
	JSL CHANGE_MUSIC
	BRA @UNKNOWN16
@UNKNOWN20:
	LDA @VIRTUAL04
	JSL DISPLAY_ANIMATED_NAMING_SPRITE
	LDA #FILE_MENU_NEW_GAME_NAME::DOG
	CLC
	SBC @VIRTUAL04
	BRANCHLTEQS @UNKNOWN24
	LOADPTR FILE_SELECT_TEXT_PLEASE_NAME_THEM_STRINGS, @VIRTUAL06
	LDA @VIRTUAL04
	OPTIMIZED_MULT @VIRTUAL04, 40
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	STA @LOCAL00
	LDA @VIRTUAL06+2
	STA @LOCAL00+2
	LDA #NAME_THEM_STRING_LENGTH
	STA @LOCAL01
	LDA @LOCAL08
	STA @VIRTUAL04
	LDY @VIRTUAL04
	STY @LOCAL07
	LDA @VIRTUAL04
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	CLC
	ADC #.LOWORD(PARTY_CHARACTERS)
	TAX
	LDA #.SIZEOF(char_struct::name)
	LDY @LOCAL07
	JSR NAME_A_CHARACTER
	CMP #0
	BEQ @UNKNOWN23
	LDA #$FFFF
	STA @VIRTUAL02
	STA @LOCAL06
	JMP @UNKNOWN30
@UNKNOWN23:
	LDA #1
	STA @VIRTUAL02
	STA @LOCAL06
	JMP @UNKNOWN30
@UNKNOWN24:
	LDA @VIRTUAL04
	CMP #FILE_MENU_NEW_GAME_NAME::DOG
	BNE @UNKNOWN26
	LOADPTR FILE_SELECT_TEXT_PLEASE_NAME_THEM_STRINGS, @VIRTUAL06
	LDA @VIRTUAL04
	OPTIMIZED_MULT @VIRTUAL04, 40
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	STA @LOCAL00
	LDA @VIRTUAL06+2
	STA @LOCAL00+2
	LDA #NAME_THEM_STRING_LENGTH
	STA @LOCAL01
	LDA @LOCAL08
	STA @VIRTUAL04
	LDY @VIRTUAL04
	LDX #.LOWORD(GAME_STATE) + game_state::pet_name
	LDA #.SIZEOF(game_state::pet_name)
	JSR NAME_A_CHARACTER
	CMP #0
	BEQ @UNKNOWN25
	LDA #$FFFF
	STA @VIRTUAL02
	STA @LOCAL06
	JMP @UNKNOWN30
@UNKNOWN25:
	LDA #1
	STA @VIRTUAL02
	STA @LOCAL06
	JMP @UNKNOWN30
@UNKNOWN26:
	LDA @VIRTUAL04
	CMP #FILE_MENU_NEW_GAME_NAME::FAVORITE_FOOD
	BNE @UNKNOWN28
	LOADPTR FILE_SELECT_TEXT_PLEASE_NAME_THEM_STRINGS, @VIRTUAL06
	LDA @VIRTUAL04
	OPTIMIZED_MULT @VIRTUAL04, 40
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	STA @LOCAL00
	LDA @VIRTUAL06+2
	STA @LOCAL00+2
	LDA #NAME_THEM_STRING_LENGTH
	STA @LOCAL01
	LDA @LOCAL08
	STA @VIRTUAL04
	LDY @VIRTUAL04
	LDX #.LOWORD(GAME_STATE) + game_state::favourite_food
	LDA #.SIZEOF(game_state::favourite_food)
	JSR NAME_A_CHARACTER
	CMP #0
	BEQ @UNKNOWN27
	LDA #$FFFF
	STA @VIRTUAL02
	STA @LOCAL06
	BRA @UNKNOWN30
@UNKNOWN27:
	LDA #1
	STA @VIRTUAL02
	STA @LOCAL06
	BRA @UNKNOWN30
@UNKNOWN28:
	LDA @VIRTUAL04
	CMP #FILE_MENU_NEW_GAME_NAME::FAVORITE_THING
	BNE @UNKNOWN30
	LOADPTR FILE_SELECT_TEXT_PLEASE_NAME_THEM_STRINGS, @VIRTUAL06
	LDA @VIRTUAL04
	OPTIMIZED_MULT @VIRTUAL04, 40
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	STA @LOCAL00
	LDA @VIRTUAL06+2
	STA @LOCAL00+2
	LDA #NAME_THEM_STRING_LENGTH
	STA @LOCAL01
	LDA @LOCAL08
	STA @VIRTUAL04
	LDY @VIRTUAL04
	LDX #.LOWORD(GAME_STATE) + game_state::favourite_thing + 4 ; part after 'PSI ' prefix
.IF .DEFINED(PROTOTYPE19950327) ;oops?
	LDA #.SIZEOF(game_state::favourite_thing) - 5
.ELSE
	LDA #.SIZEOF(game_state::favourite_thing) - 6
.ENDIF
	JSR NAME_A_CHARACTER
	CMP #0
	BEQ @UNKNOWN29
	LDA #$FFFF
	STA @VIRTUAL02
	STA @LOCAL06
	BRA @UNKNOWN30
@UNKNOWN29:
	LDA #1
	STA @VIRTUAL02
	STA @LOCAL06
@UNKNOWN30:
	LDA @VIRTUAL04
	JSL UNKNOWN_C4D830
	LDA @LOCAL06
	STA @VIRTUAL02
	LDA @VIRTUAL04
	CLC
	ADC @VIRTUAL02
	STA @VIRTUAL04
	STA @LOCAL08
@UNKNOWN31:
	LDA #THINGS_NAMED_COUNT
	CLC
	SBC @VIRTUAL04
	JUMPGTS @UNKNOWN19
	JSR UNKNOWN_C1008E
	JSR SET_INSTANT_PRINTING
	LDX #0
	STX @LOCAL08
	BRA @UNKNOWN35
@UNKNOWN34:
	TXA
	CLC
	ADC #WINDOW::FILE_SELECT_NAMING_CONFIRMATION_NESS
	JSR CREATE_WINDOW
	LDX @LOCAL08
	INX
	STX @LOCAL08
	TXA
	JSR UNKNOWN_C1931B
	LDX @LOCAL08
	STX @LOCAL08
@UNKNOWN35:
	STX @VIRTUAL04
	LDA #PLAYER_CHAR_COUNT
	CLC
	SBC @VIRTUAL04
	BRANCHGTS @UNKNOWN34
	CREATE_WINDOW_NEAR #WINDOW::FILE_SELECT_NAMING_CONFIRMATION_KING
	LDA #7
	JSR UNKNOWN_C1931B
	LDA #WINDOW::FILE_SELECT_NAMING_CONFIRMATION_FOOD
	JSR CREATE_WINDOW
	LOADPTR FILE_SELECT_TEXT_FAVORITE_FOOD, @LOCAL00
	LDA #14
	JSR PRINT_STRING
	PROMOTENEARPTR GAME_STATE + game_state::favourite_food, @VIRTUAL06
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT @VIRTUAL06, @LOCAL00
	JSL STRLEN
	STA @LOCAL05
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDX #0
	LDA @LOCAL05
	JSL UNKNOWN_C44FF3
	TAX
	ASL
	PHP
	LSR
	LSR
	LSR
	LSR
	PLP
	BCC @UNKNOWN38
	ORA #$F000
@UNKNOWN38:
	STA @LOCAL08
	LDY #8
	TXA
	JSL MODULUS16S
	CMP #0
	BNE @UNKNOWN39
	LDA @LOCAL08
	CMP #6
	BNE @UNKNOWN40
@UNKNOWN39:
	LDA @LOCAL08
	INC
@UNKNOWN40:
	LDX #1
	STX @LOCAL04
	STA @VIRTUAL04
	LDA OPEN_WINDOW_TABLE + WINDOW::FILE_SELECT_NAMING_CONFIRMATION_FOOD * 2
	LDY #.SIZEOF(window_stats)
	JSL MULT168
	TAX
	LDA WINDOW_STATS+window_stats::width,X
	SEC
	SBC @VIRTUAL04
	LDX @LOCAL04
	JSL UNKNOWN_C438A5
	PROMOTENEARPTR GAME_STATE + game_state::favourite_food, @VIRTUAL06
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT @VIRTUAL06, @LOCAL00
	JSL STRLEN
	STA @LOCAL08
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDA @LOCAL08
	JSR PRINT_STRING
	LDA #WINDOW::FILE_SELECT_NAMING_CONFIRMATION_THING
	JSR CREATE_WINDOW
	LOADPTR FILE_SELECT_TEXT_COOLEST_THING, @LOCAL00
	LDA #14
	JSR PRINT_STRING
	PROMOTENEARPTR GAME_STATE + game_state::favourite_thing + 4, @VIRTUAL06 ; part after 'PSI ' prefix
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT @VIRTUAL06, @LOCAL00
	JSL STRLEN
	STA @LOCAL05
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDX #0
	LDA @LOCAL05
	JSL UNKNOWN_C44FF3
.IF !.DEFINED(PROTOTYPE19950327)
	TAX
.ENDIF
	ASL
	PHP
	LSR
	LSR
	LSR
	LSR
	PLP
	BCC @UNKNOWN41
	ORA #$F000
@UNKNOWN41:
	STA @LOCAL08
	LDY #8
.IF !.DEFINED(PROTOTYPE19950327)
	TXA
.ENDIF
	JSL MODULUS16S
	CMP #0
	BNE @UNKNOWN42
	LDA @LOCAL08
	CMP #6
	BNE @UNKNOWN43
@UNKNOWN42:
	LDA @LOCAL08
	INC
@UNKNOWN43:
	LDX #1
	STX @LOCAL07
	STA @VIRTUAL04
	LDA OPEN_WINDOW_TABLE + WINDOW::FILE_SELECT_NAMING_CONFIRMATION_THING * 2
	LDY #.SIZEOF(window_stats)
	JSL MULT168
	TAX
	LDA WINDOW_STATS+window_stats::width,X
	SEC
	SBC @VIRTUAL04
	LDX @LOCAL07
	JSL UNKNOWN_C438A5
	PROMOTENEARPTR GAME_STATE + game_state::favourite_thing + 4, @VIRTUAL06 ; part after 'PSI ' prefix
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT @VIRTUAL06, @LOCAL00
	JSL STRLEN
	STA @LOCAL08
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDA @LOCAL08
	JSR PRINT_STRING
	CREATE_WINDOW_NEAR #WINDOW::FILE_SELECT_NAMING_CONFIRMATION_MESSAGE
	LOADPTR FILE_SELECT_TEXT_ARE_YOU_SURE, @LOCAL00
	LDA #13
	JSR PRINT_STRING
	MOVE_INT_CONSTANT NULL, @VIRTUAL06
	LOADPTR FILE_SELECT_TEXT_ARE_YOU_SURE_YEP, @LOCAL00
	MOVE_INT @VIRTUAL06, @LOCAL01
	LDY #0
	LDX #14
	LDA #1
	JSR UNKNOWN_C1153B
	LOADPTR FILE_SELECT_TEXT_ARE_YOU_SURE_NOPE, @LOCAL00
	MOVE_INT @VIRTUAL06, @LOCAL01
	LDY #0
	LDX #18
	TYA
	JSR UNKNOWN_C1153B
	JSR PRINT_MENU_ITEMS
	JSL UNKNOWN_C4D8FA
	LDA #$00FF
	STA ENABLE_WORD_WRAP
	LDA #1
	JSR SELECTION_MENU
	TAX
	BNE @EVERYTHING_OKAY
	JSL UNKNOWN_C021E6
	JMP @UNKNOWN18
@EVERYTHING_OKAY:
	LDA #MUSIC::NAME_CONFIRMATION
	JSL CHANGE_MUSIC
	JSL WINDOW_TICK
	LDX #0
	STX @LOCAL08ALT
	BRA @UNKNOWN46
@UNKNOWN45:
	JSL UNKNOWN_C1004E
	LDX @LOCAL08ALT
	INX
	STX @LOCAL08ALT
@UNKNOWN46:
	STX @VIRTUAL02
	LDA #180
	CLC
	SBC @VIRTUAL02
	BRANCHGTS @UNKNOWN45
	JSL UNKNOWN_C021E6
	STZ @LOCAL05
	JMP @UNKNOWN51
@UNKNOWN49:
	LDA @LOCAL05
	STA @VIRTUAL04
	INC @VIRTUAL04
	LDA @VIRTUAL04
	STA @LOCAL08ALT2
	LOADPTR INITIAL_STATS, @VIRTUAL06
	LDA @LOCAL05
	OPTIMIZED_MULT @VIRTUAL04, .SIZEOF(initial_stats)
	STA @VIRTUAL02
	LDY #0
	LDA @VIRTUAL02
	CLC
	ADC #initial_stats::level
	MOVE_INTX @VIRTUAL06, @VIRTUAL0A
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	LDA [@VIRTUAL0A]
	TAX
	LDA @LOCAL08ALT2
	STA @VIRTUAL04
	JSR RESET_CHAR_LEVEL_ONE
	LDA @VIRTUAL02
	CLC
	ADC #initial_stats::exp
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	LDA [@VIRTUAL06]
	BEQ @UNKNOWN50
	STORE_INT1632 @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDX #0
	LDA @VIRTUAL04
	JSL GAIN_EXP
@UNKNOWN50:
	LDA @LOCAL05
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAY
	STY @LOCAL03T
	LDA PARTY_CHARACTERS+char_struct::max_hp,Y
	STA PARTY_CHARACTERS+char_struct::current_hp,Y
	STA PARTY_CHARACTERS+char_struct::current_hp_target,Y
	LDA PARTY_CHARACTERS+char_struct::max_pp,Y
	STA PARTY_CHARACTERS+char_struct::current_pp,Y
	STA PARTY_CHARACTERS+char_struct::current_pp_target,Y
	TYX
	STZ PARTY_CHARACTERS+char_struct::current_pp_fraction,X
	TYX
	STZ PARTY_CHARACTERS+char_struct::current_hp_fraction,X
	TYA
	CLC
	ADC #.LOWORD(PARTY_CHARACTERS) + char_struct::items
	STA @VIRTUAL02
	SEP #PROC_FLAGS::ACCUM8
	STZ_BADOPT @LOCAL00
	LDX #14
	REP #PROC_FLAGS::ACCUM8
	LDA @VIRTUAL02
	JSL MEMSET16
	LOADPTR INITIAL_STATS, @VIRTUAL06
	LDA @LOCAL05
	OPTIMIZED_MULT @VIRTUAL04, .SIZEOF(initial_stats)
	CLC
	ADC #initial_stats::items
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	STA @LOCAL00
	LDA @VIRTUAL06+2
	STA @LOCAL00+2
	LDX #.SIZEOF(initial_stats::items)
	LDA @VIRTUAL02
	JSL MEMCPY16
	LDA #$0400
	LDY @LOCAL03T
	STA PARTY_CHARACTERS+char_struct::hp_pp_window_options,Y
	INC @LOCAL05
@UNKNOWN51:
	LDA #PLAYER_CHAR_COUNT
	CLC
	SBC @LOCAL05
	JUMPGTS @UNKNOWN49
	LOADPTR INITIAL_STATS, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL02
	LDY #initial_stats::money
	LDA [@VIRTUAL06],Y
	STORE_INT1632 @VIRTUAL06
	MOVE_INT @VIRTUAL06, GAME_STATE+game_state::money_carried
	MOVE_INT @LOCAL02, @VIRTUAL06
	LDY #initial_stats::unknown2
	LDA [@VIRTUAL06],Y
	ASL
	ASL
	ASL
	TAX
	LDA [@VIRTUAL06]
	ASL
	ASL
	ASL
	JSL UNKNOWN_C0B65F
	SEP #PROC_FLAGS::ACCUM8
	LDA #CHAR::P
	STA GAME_STATE+game_state::favourite_thing
	LDA #CHAR::S_
	STA GAME_STATE+game_state::favourite_thing+1
	LDA #CHAR::I
	STA GAME_STATE+game_state::favourite_thing+2
	LDA #CHAR::SPACE
	STA GAME_STATE+game_state::favourite_thing+3
.IF !.DEFINED(PROTOTYPE19950327)
	REP #PROC_FLAGS::ACCUM8
	LDA #4 ;Length of 'PSI ' string
	STA @LOCAL05
	BRA @UNKNOWN56
@UNKNOWN54:
	LDA @LOCAL05
	CLC
	ADC #.LOWORD(GAME_STATE) + game_state::favourite_thing
	TAX
	LDA __BSS_START__,X
	AND #$00FF
	BNE @UNKNOWN55
	SEP #PROC_FLAGS::ACCUM8
	LDA #CHAR::SPACE
	STA __BSS_START__,X
	BRA @UNKNOWN58
@UNKNOWN55:
	LDA @LOCAL05
	INC
	STA @LOCAL05
@UNKNOWN56:
	.A16
	STA @VIRTUAL02
	LDA #.SIZEOF(game_state::favourite_thing) - 1 ;Last byte should be \0
	CLC
	SBC @VIRTUAL02
	BRANCHGTS @UNKNOWN54
@UNKNOWN58:
	SEP #PROC_FLAGS::ACCUM8
.ENDIF
	LDA #1
	STA GAME_STATE + game_state::unknownC3
	REP #PROC_FLAGS::ACCUM8
	LDA GAME_STATE+game_state::leader_x_coord
	STA RESPAWN_X
	LDA GAME_STATE+game_state::leader_y_coord
	STA RESPAWN_Y
	JSL UNKNOWN_C064D4
	LDX #1768
	LDA #2112
	JSL UNKNOWN_C0B65F
	LOADPTR MSG_EVT_PROLOGUE_NEW, @LOCAL00
	JSL UNKNOWN_C46881
	LDX #1
	LDA #EVENT_FLAG::FLG_SYS_MONSTER_OFF
	JSL SET_EVENT_FLAG
	LDA #1
	STA SHOW_NPC_FLAG
@UNKNOWN59:
	JSR UNKNOWN_C1008E
	JSL UNKNOWN_C3EBCA
	LDA GAME_STATE+game_state::text_speed
	AND #$00FF
	STA @LOCAL06ALT
	TAX
	DEX
	LOADPTR UNKNOWN_C3FB1F, @VIRTUAL0A
	TXA
	ASL
	ASL
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	DEREFERENCE_PTR_TO @VIRTUAL0A, @VIRTUAL06
	MOVE_INT @VIRTUAL06, HP_METER_SPEED
	STX SELECTED_TEXT_SPEED
	LDA @LOCAL06ALT
	CMP #3
	BNE @UNKNOWN60
	LDA #0
	BRA @UNKNOWN61
@UNKNOWN60:
	OPTIMIZED_MULT @VIRTUAL04, 30
@UNKNOWN61:
	STA TEXT_SPEED_BASED_WAIT
	STZ UNREAD_7E5DBA
	DISPLAY_TEXT_PTR MSG_SYS_PRE_GAMESTART
	END_C_FUNCTION
