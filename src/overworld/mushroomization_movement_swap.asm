
MUSHROOMIZATION_MOVEMENT_SWAP:
	BEGIN_C_FUNCTION
	STACK_RESERVE_VARS
	STACK_RESERVE_INT16
	END_STACK_VARS
	LDA MUSHROOMIZATION_TIMER
	BNE @STILL_HAS_TIME_LEFT
	LDA #TIME_BETWEEN_DIRECTION_SWAPS
	STA MUSHROOMIZATION_TIMER
	LDX #.LOWORD(MUSHROOMIZATION_MODIFIER)
	LDA __BSS_START__,X
	INC
	STA __BSS_START__,X
	AND #$0003
	STA __BSS_START__,X
@STILL_HAS_TIME_LEFT:
	DEC MUSHROOMIZATION_TIMER
	LDA MUSHROOMIZATION_MODIFIER
	STA @LOCAL00
	BEQ @RETURN
	LDA DEMO_FRAMES_LEFT
	BNE @RETURN
	LDA PAD_PRESS
	XBA
	AND #$00FF
	AND #$000F
	TAY
	LDA PAD_STATE
	XBA
	AND #$00FF
	AND #$000F
	TAX
	LOADPTR MUSHROOMIZATION_DIRECTION_REMAP_TABLES, @VIRTUAL06
	LDA @LOCAL00
	DEC
	OPTIMIZED_MULT @VIRTUAL04, 32
	STA @LOCAL00
	TYA
	ASL
	STA @VIRTUAL04
	LDA @LOCAL00
	CLC
	ADC @VIRTUAL04
	MOVE_INTY @VIRTUAL06, @VIRTUAL0A
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	LDA [@VIRTUAL0A]
	STA @VIRTUAL02
	LDA PAD_PRESS
	AND #$F0FF
	ORA @VIRTUAL02
	STA PAD_PRESS
	TXA
	ASL
	STA @VIRTUAL04
	LDA @LOCAL00
	CLC
	ADC @VIRTUAL04
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	LDA [@VIRTUAL06]
	STA @VIRTUAL02
	LDA PAD_STATE
	AND #$F0FF
	ORA @VIRTUAL02
	STA PAD_STATE
@RETURN:
	END_C_FUNCTION
