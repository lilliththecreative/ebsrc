
LOAD_TOWN_MAP_DATA: ;$C4D553
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8 | PROC_FLAGS::CARRY
	RESERVE_STACK_SPACE 24
	TAY
	STY $16
	LDX #$0001
	LDA #$0002
	JSL FADE_OUT
	LOADPTR TOWN_MAP_GFX_POINTER_TABLE, $0A
	LDY $16
	TYA
	ASL
	ASL
	CLC
<<<<<<< HEAD
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	DEREFERENCE_PTR_TO @VIRTUAL0A, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL00
	LOADPTR BUFFER, @LOCAL01
=======
	ADC $0A
	STA $0A
	DEREFERENCE_PTR_TO $0A, $06
	MOVE_INT $06, $0E
	LOADPTR UNKNOWN_7F0000, $12
>>>>>>> parent of e89e3811 (switch to new stack macro, delete old one and replace some magic numbers)
	JSL DECOMP
@UNKNOWN0:
	LDA FADE_PARAMETERS + fade_parameters::step
	AND #$00FF
	BNE @UNKNOWN0
<<<<<<< HEAD
	LOADPTR BUFFER, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDX #BPP4PALETTE_SIZE * 2
	LDA #.LOWORD(PALETTES)
	JSL MEMCPY16
	LOADPTR TOWN_MAP_ICON_PALETTE, @LOCAL00
	LDX #BPP4PALETTE_SIZE * 8
	LDA #.LOWORD(PALETTES) + BPP4PALETTE_SIZE * 8
=======
	LOADPTR UNKNOWN_7F0000, $06
	MOVE_INT $06, $0E
	LDX #$0040
	LDA #$0200
	JSL MEMCPY16
	LOADPTR TOWN_MAP_ICON_PALETTE, $0E
	LDX #$0100
	LDA #$0300
>>>>>>> parent of e89e3811 (switch to new stack macro, delete old one and replace some magic numbers)
	JSL MEMCPY16
	LDY #$0000
	LDX #$3000
	TYA ;BG_TILEMAP_SIZE::NORMAL
	JSL SET_BG1_VRAM_LOCATION
	LDA #$0003
	JSL SET_OAM_SIZE
	SEP #PROC_FLAGS::ACCUM8
	LDA #$0000
	STA f:CGADSUB
	STA f:CGWSEL
	LDA #$0001
	STA TM_MIRROR
	STZ TD_MIRROR
	REP #PROC_FLAGS::ACCUM8
<<<<<<< HEAD
	COPY_TO_VRAM1 BUFFER + $40, $3000, $800, 0
	.A16
	COPY_TO_VRAM3 BUFFER + $840, $0000, $4000, 0
=======
	COPY_TO_VRAM1 UNKNOWN_7F0040, $3000, $800, $00
	.A16
	COPY_TO_VRAM3 UNKNOWN_7F0840, $0000, $4000, $00
>>>>>>> parent of e89e3811 (switch to new stack macro, delete old one and replace some magic numbers)
	.A16
	LOADPTR TOWN_MAP_LABEL_GFX, $0E
	MOVE_INT $06, $12
	JSL DECOMP
	COPY_TO_VRAM1P $06, $6000, TOWN_MAP_LABEL_GFX_SIZE, $00
	.A16
	LDA #$0018
	JSL UNKNOWN_C0856B
	SEP #PROC_FLAGS::ACCUM8
	LDA #$0011
	STA TM_MIRROR
	REP #PROC_FLAGS::ACCUM8
	STZ BG1_Y_POS
	STZ BG1_X_POS
	JSL UPDATE_SCREEN
	LDX #$0001
	LDA #$0002
	JSL FADE_IN
	PLD
	RTS
