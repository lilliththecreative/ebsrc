
;  Initializes an entity along with other entity vars
; A = actipn script, X,Y = coordinates
INIT_ENTITY_WIPE:
	PHA
	STZ NEW_ENTITY_POS_Z
	STZ NEW_ENTITY_VAR0
	STZ NEW_ENTITY_VAR1
	STZ NEW_ENTITY_VAR2
	STZ NEW_ENTITY_VAR3
	STZ NEW_ENTITY_VAR4
	STZ NEW_ENTITY_VAR5
	STZ NEW_ENTITY_VAR6
	STZ NEW_ENTITY_VAR7
	STZ NEW_ENTITY_PRIORITY
	LDA #$0000
	STA ENTITY_ALLOCATION_MIN_SLOT
	LDA #$001E
	STA ENTITY_ALLOCATION_MAX_SLOT
	PLA
; Initializes an entity
;A = action script, X,Y = coordinates
INIT_ENTITY:
	PHA
	PHY
	PHX
	LDA ENTITY_ALLOCATION_MIN_SLOT
	ASL
	STA ENTITY_ALLOCATION_MIN_SLOT
	LDA ENTITY_ALLOCATION_MAX_SLOT
	ASL
	STA ENTITY_ALLOCATION_MAX_SLOT
	JSR UNKNOWN_C09C02
	BCC @UNKNOWN0
	PLA
	PLA
	PLA
	LDA #$0000
	RTL
@UNKNOWN0:
	JSR UNKNOWN_C09D03
	TYA
	STA ENTITY_SCRIPT_INDEX_TABLE,X
	LDA #$FFFF
	STA ENTITY_SCRIPT_NEXT_SCRIPTS,Y
	LDA #.LOWORD(UNKNOWN_C09FAE_ENTRY2)
	STA ENTITY_MOVE_CALLBACK,X
	LDA #.LOWORD(UNKNOWN_C0A023)
	STA ENTITY_SCREEN_POSITION_CALLBACK,X
	LDA #.LOWORD(UNKNOWN_C0A3A4)
	STA ENTITY_DRAW_CALLBACK,X
	LDA NEW_ENTITY_VAR0
	STA ENTITY_SCRIPT_VAR0_TABLE,X
	LDA NEW_ENTITY_VAR1
	STA ENTITY_SCRIPT_VAR1_TABLE,X
	LDA NEW_ENTITY_VAR2
	STA ENTITY_SCRIPT_VAR2_TABLE,X
	LDA NEW_ENTITY_VAR3
	STA ENTITY_SCRIPT_VAR3_TABLE,X
	LDA NEW_ENTITY_VAR4
	STA ENTITY_SCRIPT_VAR4_TABLE,X
	LDA NEW_ENTITY_VAR5
	STA ENTITY_SCRIPT_VAR5_TABLE,X
	LDA NEW_ENTITY_VAR6
	STA ENTITY_SCRIPT_VAR6_TABLE,X
	LDA NEW_ENTITY_VAR7
	STA ENTITY_SCRIPT_VAR7_TABLE,X
	LDA NEW_ENTITY_PRIORITY
	STA ENTITY_DRAW_PRIORITY,X
	LDA #$8000
	STA ENTITY_ABS_X_FRACTION_TABLE,X
	STA ENTITY_ABS_Y_FRACTION_TABLE,X
	STA ENTITY_ABS_Z_FRACTION_TABLE,X
	PLA
	STA ENTITY_ABS_X_TABLE,X
	STA ENTITY_SCREEN_X_TABLE,X
	PLA
	STA ENTITY_ABS_Y_TABLE,X
	STA ENTITY_SCREEN_Y_TABLE,X
	LDA NEW_ENTITY_POS_Z
	STA ENTITY_ABS_Z_TABLE,X
	JSR UNKNOWN_C09C57
	PLA
	BRA @UNKNOWN1
	PHA
	JSR UNKNOWN_C09C99
	JSR UNKNOWN_C09D03
	TYA
	STA ENTITY_SCRIPT_INDEX_TABLE,X
	LDA #$FFFF
	STA ENTITY_SCRIPT_NEXT_SCRIPTS,Y
	PLA
@UNKNOWN1:
	STA ENTITY_SCRIPT_TABLE,X
	PHX
	ASL
	ADC ENTITY_SCRIPT_TABLE,X
	TXY
	TAX
	LDA f:EVENT_SCRIPT_POINTERS+2,X
	TAY
	LDA f:EVENT_SCRIPT_POINTERS,X
	PLX
	STZ ENTITY_ANIMATION_FRAME,X
	DEC ENTITY_ANIMATION_FRAME,X
	STZ ENTITY_DELTA_X_FRACTION_TABLE,X
	STZ ENTITY_DELTA_X_TABLE,X
	STZ ENTITY_DELTA_Y_FRACTION_TABLE,X
	STZ ENTITY_DELTA_Y_TABLE,X
	STZ ENTITY_DELTA_Z_FRACTION_TABLE,X
	STZ ENTITY_DELTA_Z_TABLE,X
	BRA UNKNOWN_C092F5_UNKNOWN4
INIT_ENTITY_UNKNOWN1:
	PHA
	TXA
	ASL
	TAX
	PLA
	JSL INIT_ENTITY_UNKNOWN2
	RTL
INIT_ENTITY_UNKNOWN2:
	PHY
	PHA
	LDA ENTITY_SCRIPT_TABLE,X
	BPL @DONT_LOOP
@LOOP:
	BRA @LOOP
@DONT_LOOP:
	JSR UNKNOWN_C09C99
	JSR UNKNOWN_C09D03
	TYA
	STA ENTITY_SCRIPT_INDEX_TABLE,X
	LDA #$FFFF
	STA ENTITY_SCRIPT_NEXT_SCRIPTS,Y
	PLA
	PLY
UNKNOWN_C092F5_UNKNOWN4:
	PHY
	PHA
	JSR CLEAR_SPRITE_TICK_CALLBACK
	TXY
	LDX ENTITY_SCRIPT_INDEX_TABLE,Y
	PLA
	STA ENTITY_SCRIPT_PROGRAM_COUNTERS,X
	PLA
	AND #$00FF
	STA ENTITY_SCRIPT_PROGRAM_COUNTER_BANKS,X
	STZ ENTITY_SCRIPT_SLEEP_FRAMES,X
	STZ ENTITY_SCRIPT_STACK_OFFSETS,X
	TYA
	LSR
	CLC
MOVEMENT_NOP:
	RTL
