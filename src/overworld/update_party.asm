
;void UpdateParty(void)
UPDATE_PARTY: ;$C034D6
	@LOCAL1 = $0E ;short[6]
	@LOCAL2 = $1A ;short[6]
	@LOCAL3 = $26 ;short[6]
	@LOCAL4 = $32 ;short[6]
	@LOCAL5 = $3E ;short
	@LOCAL6 = $40 ;short
	@LOCAL7 = $42 ;short
	@LOCAL8 = $44 ;short
	@LOCAL9 = $46 ;short
	@LOCAL10 = $48 ;short
	@LOCAL11 = $4A ;short
	@PARTY_COUNT = $4C ;short
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8 | PROC_FLAGS::CARRY
	RESERVE_STACK_SPACE_CLOBBER 78
	LDA GAME_STATE+game_state::party_count
	AND #$00FF
	STA @PARTY_COUNT
	LDA #$0000
	STA @LOCAL11
	BRA @UNKNOWN1
@UNKNOWN0:
	ASL
	PHA
	LDA @LOCAL11
	TAX
	LDA GAME_STATE+game_state::player_controlled_party_members,X
	AND #$00FF
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA PARTY_CHARACTERS+char_struct::position_index,X
	PLX
	STA @LOCAL1,X
	LDA @LOCAL11
	INC
	STA @LOCAL11
@UNKNOWN1:
	CMP @PARTY_COUNT
	BCC @UNKNOWN0
	LDY #$0000
	STY @LOCAL10
	BRA @UNKNOWN6
@UNKNOWN2:
	LDA GAME_STATE + game_state::unknown96,Y
	AND #$00FF
	STA @LOCAL9
	CMP #$0005
	BCC @UNKNOWN3
	CLC
	ADC #$0300
	STA @LOCAL9
	BRA @UNKNOWN5
@UNKNOWN3:
	TYA
	ASL
	TAX
	LDA GAME_STATE + game_state::unknownA2,X
	ASL
	TAX
	LDA ENTITY_SCRIPT_VAR1_TABLE,X
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA PARTY_CHARACTERS+char_struct::afflictions,X
	AND #$00FF
	TAX
	CPX #$0001
	BEQ @UNKNOWN4
	CPX #$0002
	BNE @UNKNOWN5
@UNKNOWN4:
	LDA @LOCAL9
	CLC
	ADC #$0100
	STA @LOCAL9
@UNKNOWN5:
	LDY @LOCAL10
	TYA
	ASL
	TAX
	LDA @LOCAL9
	STA @LOCAL2,X
	LDA GAME_STATE + game_state::unknownA2,X
	STA @LOCAL3,X
	LDA GAME_STATE + game_state::player_controlled_party_members,Y
	AND #$00FF
	STA @LOCAL4,X
	INY
	STY @LOCAL10
@UNKNOWN6:
	CPY @PARTY_COUNT
	BCC @UNKNOWN2
	STZ @LOCAL8
	JMP @UNKNOWN12
@UNKNOWN7:
	STZ @LOCAL7
	JMP @UNKNOWN10
@UNKNOWN8:
	LDA @LOCAL7
	ASL
	STA $02
	TDC
	CLC
	ADC #@LOCAL2
	CLC
	ADC $02
	TAY
	LDA __BSS_START__,Y
	STA @LOCAL9
	LDA $02
	STA $04
	INC $04
	INC $04
	TDC
	CLC
	ADC #@LOCAL2
	CLC
	ADC $04
	TAX
	LDA __BSS_START__,X
	STA @LOCAL11
	LDA @LOCAL9
	CMP @LOCAL11
	BLTEQ @UNKNOWN9
	LDA @LOCAL11
	STA __BSS_START__,Y
	LDA @LOCAL9
	STA __BSS_START__,X
	TDC
	CLC
	ADC #@LOCAL3
	CLC
	ADC $02
	TAY
	LDA __BSS_START__,Y
	STA @LOCAL6
	TDC
	CLC
	ADC #@LOCAL3
	CLC
	ADC $04
	TAX
	LDA __BSS_START__,X
	STA __BSS_START__,Y
	LDA @LOCAL6
	STA __BSS_START__,X
	TDC
	CLC
	ADC #@LOCAL4
	CLC
	ADC $02
	TAY
	LDA __BSS_START__,Y
	STA @LOCAL11
	TDC
	CLC
	ADC #@LOCAL4
	CLC
	ADC $04
	TAX
	LDA __BSS_START__,X
	STA __BSS_START__,Y
	LDA @LOCAL11
	STA __BSS_START__,X
@UNKNOWN9:
	INC @LOCAL7
@UNKNOWN10:
	LDA @PARTY_COUNT
	DEC
	CMP @LOCAL7
	BGTL @UNKNOWN8
	INC @LOCAL8
@UNKNOWN12:
	LDA @PARTY_COUNT
	DEC
	CMP @LOCAL8
	BGTL @UNKNOWN7
	LDA #$0000
	STA @LOCAL9
	BRA @UNKNOWN15
@UNKNOWN14:
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAY
	LDA @LOCAL9
	ASL
	STA $04
	LDX $04
	SEP #PROC_FLAGS::ACCUM8
	LDA @LOCAL2,X
	STA __BSS_START__ + game_state::unknown96,Y
	REP #PROC_FLAGS::ACCUM8
	LDA $04
	CLC
	ADC #.LOWORD(GAME_STATE) + game_state::unknownA2
	TAX
	STX @LOCAL5
	LDX $04
	LDA @LOCAL3,X
	LDX @LOCAL5
	STA __BSS_START__,X
	TDC
	CLC
	ADC #@LOCAL4
	CLC
	ADC $04
	STA $02
	LDX $02
	SEP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X
	STA __BSS_START__ + game_state::player_controlled_party_members,Y
	LDX $02
	REP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	PHA
	LDX $04
	LDA @LOCAL1,X
	PLX
<<<<<<< HEAD
	STA PARTY_CHARACTERS+char_struct::position_index,X
	LDX @LOCAL04
=======
	STA CHAR_STRUCT+char_struct::position_index,X
	LDX @LOCAL5
>>>>>>> parent of e89e3811 (switch to new stack macro, delete old one and replace some magic numbers)
	LDA __BSS_START__,X
	ASL
	TAX
	LDA $04
	STA ENTITY_SCRIPT_VAR5_TABLE,X
	LDA @LOCAL9
	INC
	STA @LOCAL9
@UNKNOWN15:
	CMP @PARTY_COUNT
	BCC @UNKNOWN14
	LDA GAME_STATE +game_state::unknownA2
	STA GAME_STATE+game_state::current_party_members
	JSL UNKNOWN_C032EC
	JSL UNKNOWN_C02C3E
	JSL UNKNOWN_C47F87
	PLD
	RTL
