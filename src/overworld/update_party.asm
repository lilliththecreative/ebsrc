
UPDATE_PARTY:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_ARRAY 6, 2 ;int[6]
	STACK_RESERVE_ARRAY 6, 2 ;int[6]
	STACK_RESERVE_ARRAY 6, 2 ;int[6]
	STACK_RESERVE_ARRAY 6, 2 ;int[6]
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16 "PARTY_COUNT"
	END_STACK_VARS
	LDA GAME_STATE+game_state::party_count
	AND #$00FF
	STA @PARTY_COUNT
	LDA #0
	STA @LOCAL0A
	BRA @UNKNOWN1
@UNKNOWN0:
	ASL
	PHA
	LDA @LOCAL0A
	TAX
	LDA GAME_STATE+game_state::player_controlled_party_members,X
	AND #$00FF
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA PARTY_CHARACTERS+char_struct::position_index,X
	PLX
	STA @LOCAL00,X
	LDA @LOCAL0A
	INC
	STA @LOCAL0A
@UNKNOWN1:
	CMP @PARTY_COUNT
	BCC @UNKNOWN0
	LDY #0
	STY @LOCAL09
	BRA @UNKNOWN6
@UNKNOWN2:
	LDA GAME_STATE + game_state::unknown96,Y
	AND #$00FF
	STA @LOCAL08
	CMP #5
	BCC @UNKNOWN3
	CLC
	ADC #$0300
	STA @LOCAL08
	BRA @UNKNOWN5
@UNKNOWN3:
	TYA
	ASL
	TAX
	LDA GAME_STATE + game_state::unknownA2,X
	ASL
	TAX
	LDA ENTITY_SCRIPT_VAR1_TABLE,X
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA PARTY_CHARACTERS+char_struct::afflictions,X
	AND #$00FF
	TAX
	CPX #1
	BEQ @UNKNOWN4
	CPX #2
	BNE @UNKNOWN5
@UNKNOWN4:
	LDA @LOCAL08
	CLC
	ADC #$0100
	STA @LOCAL08
@UNKNOWN5:
	LDY @LOCAL09
	TYA
	ASL
	TAX
	LDA @LOCAL08
	STA @LOCAL01,X
	LDA GAME_STATE + game_state::unknownA2,X
	STA @LOCAL02,X
	LDA GAME_STATE + game_state::player_controlled_party_members,Y
	AND #$00FF
	STA @LOCAL03,X
	INY
	STY @LOCAL09
@UNKNOWN6:
	CPY @PARTY_COUNT
	BCC @UNKNOWN2
	STZ @LOCAL07
	JMP @UNKNOWN12
@UNKNOWN7:
	STZ @LOCAL06
	JMP @UNKNOWN10
@UNKNOWN8:
	LDA @LOCAL06
	ASL
	STA @VIRTUAL02
	TDC
	CLC
	ADC #@LOCAL01
	CLC
	ADC @VIRTUAL02
	TAY
	LDA __BSS_START__,Y
	STA @LOCAL08
	LDA @VIRTUAL02
	STA @VIRTUAL04
	INC @VIRTUAL04
	INC @VIRTUAL04
	TDC
	CLC
	ADC #@LOCAL01
	CLC
	ADC @VIRTUAL04
	TAX
	LDA __BSS_START__,X
	STA @LOCAL0A
	LDA @LOCAL08
	CMP @LOCAL0A
	BLTEQ @UNKNOWN9
	LDA @LOCAL0A
	STA __BSS_START__,Y
	LDA @LOCAL08
	STA __BSS_START__,X
	TDC
	CLC
	ADC #@LOCAL02
	CLC
	ADC @VIRTUAL02
	TAY
	LDA __BSS_START__,Y
	STA @LOCAL05
	TDC
	CLC
	ADC #@LOCAL02
	CLC
	ADC @VIRTUAL04
	TAX
	LDA __BSS_START__,X
	STA __BSS_START__,Y
	LDA @LOCAL05
	STA __BSS_START__,X
	TDC
	CLC
	ADC #@LOCAL03
	CLC
	ADC @VIRTUAL02
	TAY
	LDA __BSS_START__,Y
	STA @LOCAL0A
	TDC
	CLC
	ADC #@LOCAL03
	CLC
	ADC @VIRTUAL04
	TAX
	LDA __BSS_START__,X
	STA __BSS_START__,Y
	LDA @LOCAL0A
	STA __BSS_START__,X
@UNKNOWN9:
	INC @LOCAL06
@UNKNOWN10:
	LDA @PARTY_COUNT
	DEC
	CMP @LOCAL06
	BGTL @UNKNOWN8
	INC @LOCAL07
@UNKNOWN12:
	LDA @PARTY_COUNT
	DEC
	CMP @LOCAL07
	BGTL @UNKNOWN7
	LDA #0
	STA @LOCAL08
	BRA @UNKNOWN15
@UNKNOWN14:
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAY
	LDA @LOCAL08
	ASL
	STA @VIRTUAL04
	LDX @VIRTUAL04
	SEP #PROC_FLAGS::ACCUM8
	LDA @LOCAL01,X
	STA __BSS_START__ + game_state::unknown96,Y
	REP #PROC_FLAGS::ACCUM8
	LDA @VIRTUAL04
	CLC
	ADC #.LOWORD(GAME_STATE) + game_state::unknownA2
	TAX
	STX @LOCAL04
	LDX @VIRTUAL04
	LDA @LOCAL02,X
	LDX @LOCAL04
	STA __BSS_START__,X
	TDC
	CLC
	ADC #@LOCAL03
	CLC
	ADC @VIRTUAL04
	STA @VIRTUAL02
	LDX @VIRTUAL02
	SEP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X
	STA __BSS_START__ + game_state::player_controlled_party_members,Y
	LDX @VIRTUAL02
	REP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	PHA
	LDX @VIRTUAL04
	LDA @LOCAL00,X
	PLX
	STA PARTY_CHARACTERS+char_struct::position_index,X
	LDX @LOCAL04
	LDA __BSS_START__,X
	ASL
	TAX
	LDA @VIRTUAL04
	STA ENTITY_SCRIPT_VAR5_TABLE,X
	LDA @LOCAL08
	INC
	STA @LOCAL08
@UNKNOWN15:
	CMP @PARTY_COUNT
	BCC @UNKNOWN14
	LDA GAME_STATE +game_state::unknownA2
	STA GAME_STATE+game_state::current_party_members
	JSL UNKNOWN_C032EC
	JSL UNKNOWN_C02C3E
	JSL UNKNOWN_C47F87
	END_C_FUNCTION
