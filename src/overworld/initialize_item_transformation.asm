
INITIALIZE_ITEM_TRANSFORMATION:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_PARAM_INT16
	END_STACK_VARS
	TAX
	STX @LOCAL01
	TXA
	JSL IS_VALID_ITEM_TRANSFORMATION
	CMP #0
	BNE @UNKNOWN0
	SEP #PROC_FLAGS::ACCUM8
	LDA #60
	STA TIME_UNTIL_NEXT_ITEM_TRANSFORMATION_CHECK
	REP #PROC_FLAGS::ACCUM8
	INC ITEM_TRANSFORMATIONS_LOADED
@UNKNOWN0:
	LDX @LOCAL01
	TXA
	OPTIMIZED_MULT @VIRTUAL04, .SIZEOF(loaded_timed_item_transformation)
	CLC
	ADC #.LOWORD(LOADED_TIMED_ITEM_TRANSFORMATIONS)
	TAY
	STY @LOCAL00
	LOADPTR TIMED_ITEM_TRANSFORMATION_TABLE, @VIRTUAL06
	TXA
	OPTIMIZED_MULT @VIRTUAL04, .SIZEOF(timed_item_transformation)
	TAX
	STX @LOCAL01
	TXA
	INC
	PHA
	MOVE_INT @VIRTUAL06, @VIRTUAL0A
	PLA
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	SEP #PROC_FLAGS::ACCUM8
	LDA [@VIRTUAL0A]
	STA a:loaded_timed_item_transformation::sfx,Y
	REP #PROC_FLAGS::ACCUM8
	TXA
	INC
	INC
	MOVE_INTX @VIRTUAL06, @VIRTUAL0A
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	SEP #PROC_FLAGS::ACCUM8
	LDA [@VIRTUAL0A]
	STA @VIRTUAL00
	STA a:loaded_timed_item_transformation::sfx_frequency,Y
	REP #PROC_FLAGS::ACCUM8
	LDA #2
	JSL RAND_MOD
	SEP #PROC_FLAGS::ACCUM8
	PHA
	LDA @VIRTUAL00
	SEP #PROC_FLAGS::INDEX8
	PLX
	STX @VIRTUAL00
	CLC
	ADC @VIRTUAL00
	DEC
	REP #PROC_FLAGS::INDEX8
	LDY @LOCAL00
	STA a:loaded_timed_item_transformation::sfx_countdown,Y
	LDX @LOCAL01
	REP #PROC_FLAGS::ACCUM8
	TXA
	INC
	INC
	INC
	INC
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	SEP #PROC_FLAGS::ACCUM8
	LDA [@VIRTUAL06]
	STA a:loaded_timed_item_transformation::transformation_countdown,Y
	REP #PROC_FLAGS::ACCUM8
	END_C_FUNCTION
