
KO_TARGET:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_INT32
	STACK_RESERVE_INT32
.IF .DEFINED(JPN)
	STACK_RESERVE_INT32
	STACK_RESERVE_INT16
.ELSE
	STACK_RESERVE_INT16
	STACK_RESERVE_INT32
.ENDIF
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_PARAM_INT16 ;NEAR battler* target
	END_STACK_VARS
	STA @VIRTUAL02
	STZ SKIP_DEATH_TEXT_AND_CLEANUP
	LDX @VIRTUAL02
	LDA a:battler::ally_or_enemy,X
	AND #$00FF
	BNEL @UNKNOWN22
	LDX @VIRTUAL02
	LDA a:battler::afflictions + STATUS_GROUP::PERSISTENT_HARDHEAL,X
	AND #$00FF
	CMP #STATUS_1::POSSESSED
	BNEL @UNKNOWN10
	LDY #0
	STY @LOCAL07
	JMP @UNKNOWN9
@UNKNOWN2:
	TYA
	LDY #.SIZEOF(battler)
	JSL MULT168
	STA @LOCAL06
	TAX
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQL @UNKNOWN8
	LDA @LOCAL06
	TAX
	LDA BATTLERS_TABLE+battler::npc_id,X
	AND #$00FF
	BNEL @UNKNOWN8
	LDA @LOCAL06
	CLC
	ADC #.LOWORD(BATTLERS_TABLE) + battler::afflictions
	TAX
	LDA a:STATUS_GROUP::PERSISTENT_HARDHEAL,X
	AND #$00FF
	CMP #STATUS_1::POSSESSED
	BNE @UNKNOWN8
	LDA @LOCAL06
	CLC
	ADC #.LOWORD(BATTLERS_TABLE)
	STA @VIRTUAL04
	LDA @VIRTUAL02
	CMP @VIRTUAL04
	BNE @UNKNOWN10
	LDA BATTLERS_TABLE+(TOTAL_PARTY_COUNT)*.SIZEOF(battler)+battler::npc_id
	AND #$00FF
	CMP #ENEMY::TINY_LIL_GHOST
	BNE @UNKNOWN10
	SEP #PROC_FLAGS::ACCUM8
	STZ BATTLERS_TABLE+(TOTAL_PARTY_COUNT)*.SIZEOF(battler)+battler::consciousness
	BRA @UNKNOWN7
@UNKNOWN5:
	REP #PROC_FLAGS::ACCUM8
	TYA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN6
	LDA BATTLERS_TABLE+battler::npc_id,X
	AND #$00FF
	BNE @UNKNOWN6
	TXA
	CLC
	ADC #.LOWORD(BATTLERS_TABLE) + battler::afflictions
	TAX
	LDA a:STATUS_GROUP::PERSISTENT_HARDHEAL,X
	AND #$00FF
	CMP #STATUS_1::POSSESSED
	BNE @UNKNOWN6
	LDX #.LOWORD(BATTLERS_TABLE) + (.SIZEOF(battler) * 6)
	LDA #ENEMY::TINY_LIL_GHOST
	JSL BATTLE_INIT_ENEMY_STATS
	SEP #PROC_FLAGS::ACCUM8
	LDA #ENEMY::TINY_LIL_GHOST
	STA BATTLERS_TABLE+(TOTAL_PARTY_COUNT)*.SIZEOF(battler)+battler::npc_id
	LDA #1
	STA BATTLERS_TABLE+(TOTAL_PARTY_COUNT)*.SIZEOF(battler)+13
@UNKNOWN6:
	LDY @LOCAL07
	INY
	STY @LOCAL07
@UNKNOWN7:
	LDY @LOCAL07
	CPY #6
	BCC @UNKNOWN5
	BRA @UNKNOWN10
@UNKNOWN8:
	LDY @LOCAL07
	INY
	STY @LOCAL07
@UNKNOWN9:
	CPY #6
	BCCL @UNKNOWN2
@UNKNOWN10:
	SEP #PROC_FLAGS::ACCUM8
	LDA #STATUS_0::UNCONSCIOUS
	LDX @VIRTUAL02
	STA a:battler::afflictions + STATUS_GROUP::PERSISTENT_EASYHEAL,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::SHIELD,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::HOMESICKNESS,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::CONCENTRATION,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::STRANGENESS,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::TEMPORARY,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::PERSISTENT_HARDHEAL,X
	REP #PROC_FLAGS::ACCUM8
	LDA @VIRTUAL02
	CLC
	ADC #battler::npc_id
	TAX
	STX @LOCAL07
	LDA __BSS_START__,X
	AND #$00FF
	BEQL @UNKNOWN21
	LOADPTR ENEMY_CONFIGURATION_TABLE, @VIRTUAL0A
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::death_text_ptr
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	DEREFERENCE_PTR_TO @VIRTUAL0A, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL00
	JSL DISPLAY_IN_BATTLE_TEXT
	LDX @VIRTUAL02
	SEP #PROC_FLAGS::ACCUM8
	STZ a:battler::consciousness,X
	LDX @LOCAL07
	REP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X ;battler::npc_id
	AND #$00FF
	TAX
	CPX #PARTY_MEMBER::TEDDY_BEAR
	BEQ @UNKNOWN12
	CPX #PARTY_MEMBER::PLUSH_TEDDY_BEAR
	BNE @UNKNOWN14
@UNKNOWN12:
	LDA @VIRTUAL02
	CLC
	ADC #battler::row
	TAX
	STX @LOCAL05
	LDA __BSS_START__,X
	AND #$00FF
.IF .DEFINED(JPN)
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	LDA a:game_state::party_npc_1,X
.ELSE
	TAX
	LDA GAME_STATE+game_state::party_npc_1,X
.ENDIF
	AND #$00FF
	BEQL @UNKNOWN62
	SEP #PROC_FLAGS::ACCUM8
	LDA #1
	LDX @VIRTUAL02
	STA a:battler::consciousness,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::PERSISTENT_EASYHEAL,X
	LDX @LOCAL05
	REP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X
	AND #$00FF
	ASL
.IF .DEFINED(JPN)
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	LDA a:game_state::party_npc_1_hp,X
.ELSE
	TAX
	LDA GAME_STATE+game_state::party_npc_1_hp,X
.ENDIF
	LDX @VIRTUAL02
	STA a:battler::hp_target,X
	LDX @VIRTUAL02
	STA a:battler::hp,X
	LDX @LOCAL05
	LDA __BSS_START__,X
	AND #$00FF
.IF .DEFINED(JPN)
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA a:game_state::party_npc_1,X
.ELSE
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA GAME_STATE+game_state::party_npc_1,X
.ENDIF
	LDX @VIRTUAL02
	STA a:battler::npc_id,X
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	ASL
	TAX
	INX
	LDA f:NPC_AI_TABLE,X
	AND #$00FF
	LDX @VIRTUAL02
	STA a:battler::id,X
	JMP @UNKNOWN62
@UNKNOWN14:
	LDA GAME_STATE+game_state::party_npc_1
	AND #$00FF
	BEQL @UNKNOWN62
	LDX #.LOWORD(BATTLERS_TABLE)
	LDY #0
	BRA @UNKNOWN18
@UNKNOWN16:
	LDA a:battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN17
	LDA a:battler::ally_or_enemy,X
	AND #$00FF
	BNE @UNKNOWN17
	SEP #PROC_FLAGS::ACCUM8
	LDA a:battler::npc_id,X
	CMP GAME_STATE+game_state::party_npc_1
	BNE @UNKNOWN17
	STZ a:battler::row,X
	JMP @UNKNOWN62
@UNKNOWN17:
	REP #PROC_FLAGS::ACCUM8
	TXA
	CLC
	ADC #.SIZEOF(battler)
	TAX
	INY
@UNKNOWN18:
	STY @VIRTUAL02
	LDA #BATTLER_COUNT
	CLC
	SBC @VIRTUAL02
	BRANCHGTS @UNKNOWN16
	JMP @UNKNOWN62
@UNKNOWN21:
	LDX @VIRTUAL02
	STZ a:battler::hp_target,X
	LDA @VIRTUAL02
	CLC
	ADC #battler::row
	TAX
	STX @LOCAL04
	LDA __BSS_START__,X
	AND #$00FF
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	STZ PARTY_CHARACTERS+char_struct::current_hp_target,X
	LDX @LOCAL04
	LDA __BSS_START__,X
	AND #$00FF
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA #1
	STA PARTY_CHARACTERS+char_struct::current_hp,X
	DISPLAY_BATTLE_TEXT_PTR MSG_BTL_KIZETU_ON
	JMP @UNKNOWN62
@UNKNOWN22:
	LDX @VIRTUAL02
	LDA a:battler::id,X
	CMP #ENEMY::GIYGAS_2
	BEQL @UNKNOWN62
	CMP #ENEMY::GIYGAS_3
	BEQL @UNKNOWN62
	CMP #ENEMY::GIYGAS_5
	BEQL @UNKNOWN62
	CMP #ENEMY::GIYGAS_6
	BEQL @UNKNOWN62
	LDA #1
	JSL COUNT_CHARS
	CMP #1
	BNEL @UNKNOWN31
	JSL RESET_HPPP_ROLLING
	LDA #0
	STA @LOCAL07
	BRA @UNKNOWN30
@UNKNOWN28:
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	STX @LOCAL05
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN29
	LDA BATTLERS_TABLE+battler::ally_or_enemy,X
	AND #$00FF
	BNE @UNKNOWN29
	LDA BATTLERS_TABLE+battler::afflictions,X
	AND #$00FF
	CMP #STATUS_0::UNCONSCIOUS
	BEQ @UNKNOWN29
	LDA BATTLERS_TABLE+battler::npc_id,X
	AND #$00FF
	BNE @UNKNOWN29
	TXA
	CLC
	ADC #.LOWORD(BATTLERS_TABLE) + battler::row
	TAY
	STY @LOCAL06
	LDA __BSS_START__,Y
	AND #$00FF
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA PARTY_CHARACTERS+char_struct::current_hp,X
	BNE @UNKNOWN29
	LDA #1
	LDX @LOCAL05
	STA BATTLERS_TABLE+battler::hp_target,X
	LDY @LOCAL06
	LDA __BSS_START__,Y
	AND #$00FF
	LDY #.SIZEOF(char_struct)
	JSL MULT168
	TAX
	LDA #1
	STA PARTY_CHARACTERS+char_struct::current_hp_target,X
@UNKNOWN29:
	LDA @LOCAL07
	INC
	STA @LOCAL07
@UNKNOWN30:
	CMP #TOTAL_PARTY_COUNT
	BCC @UNKNOWN28
@UNKNOWN31:
	LDA @VIRTUAL02
	CLC
	ADC #battler::exp
	TAY
	MOVE_INT_YPTRSRC __BSS_START__, @VIRTUAL0A
	MOVE_INT BATTLE_EXP_SCRATCH, @VIRTUAL06
	CLC
	ADD_INT_ASSIGN @VIRTUAL06, @VIRTUAL0A
	MOVE_INT @VIRTUAL06, BATTLE_EXP_SCRATCH
	LDX @VIRTUAL02
	LDA a:battler::money,X
	CLC
	ADC BATTLE_MONEY_SCRATCH
	STA BATTLE_MONEY_SCRATCH
.IF .DEFINED(JPN)
	LOADPTR ENEMY_CONFIGURATION_TABLE, @VIRTUAL0A
.ELSE
	LOADPTR ENEMY_CONFIGURATION_TABLE, @LOCAL03
.ENDIF
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::final_action
.IF .DEFINED(JPN)
	MOVE_INTX @VIRTUAL0A, @VIRTUAL06
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	LDA [@VIRTUAL06]
	BEQL @UNKNOWN33
	LDA #1
	STA ENEMY_PERFORMING_FINAL_ATTACK
	LDY CURRENT_ATTACKER
	STY @LOCAL03
	LDX CURRENT_TARGET
	STX @LOCAL05
	MOVE_INT BATTLER_TARGET_FLAGS, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL02
	LDA @VIRTUAL02
	STA CURRENT_ATTACKER
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::final_action
	MOVE_INTX @VIRTUAL0A, @VIRTUAL06
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	LDA [@VIRTUAL06]
.ELSE
	TAY
	LDA [@LOCAL03],Y
	BEQL @UNKNOWN33
	LDA #1
	STA ENEMY_PERFORMING_FINAL_ATTACK
	LDX CURRENT_ATTACKER
	STX @LOCAL05
	LDY CURRENT_TARGET
	STY @LOCAL02
	MOVE_INT BATTLER_TARGET_FLAGS, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL01
	LDA @VIRTUAL02
	STA CURRENT_ATTACKER
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::final_action
	TAY
	LDA [@LOCAL03],Y
.ENDIF
	LDX @VIRTUAL02
	STA a:battler::current_action,X
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::final_action_arg
.IF .DEFINED(JPN)
	MOVE_INTX @VIRTUAL0A, @VIRTUAL06
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	SEP #PROC_FLAGS::ACCUM8
	LDA [@VIRTUAL06]
.ELSE
	TAY
	SEP #PROC_FLAGS::ACCUM8
	LDA [@LOCAL03],Y
.ENDIF
	LDX @VIRTUAL02
	STA a:battler::current_action_argument,X
	REP #PROC_FLAGS::ACCUM8
	LDA CURRENT_ATTACKER
	JSL CHOOSE_TARGET
	LDA CURRENT_ATTACKER
	JSL UNKNOWN_C24703
	LDA #0
	JSL FIX_ATTACKER_NAME
	JSL UNKNOWN_C23E32
.IF .DEFINED(JPN)
	LOADPTR BATTLE_ACTION_TABLE, @LOCAL01
.ELSE
	LOADPTR BATTLE_ACTION_TABLE, @VIRTUAL0A
.ENDIF
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::final_action
.IF .DEFINED(JPN)
	MOVE_INTX @VIRTUAL0A, @VIRTUAL06
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	LDA [@VIRTUAL06]
.ELSE
	TAY
	LDA [@LOCAL03],Y
.ENDIF
	OPTIMIZED_MULT @VIRTUAL04, 12
	INC
	INC
	INC
	INC
.IF .DEFINED(JPN)
	PHA
	MOVE_INT @LOCAL01, @VIRTUAL06
	PLA
.ELSE
	MOVE_INTX @VIRTUAL0A, @VIRTUAL06
.ENDIF
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	DEREFERENCE_PTR_TO @VIRTUAL06, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL00
	JSL DISPLAY_IN_BATTLE_TEXT
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::final_action
.IF .DEFINED(JPN)
	MOVE_INTX @VIRTUAL0A, @VIRTUAL06
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	LDA [@VIRTUAL06]
.ELSE
	TAY
	LDA [@LOCAL03],Y
.ENDIF
	OPTIMIZED_MULT @VIRTUAL04, .SIZEOF(battle_action)
	CLC
	ADC #battle_action::battle_function_pointer
.IF .DEFINED(JPN)
	PHA
	MOVE_INT @LOCAL01, @VIRTUAL06
	PLA
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	DEREFERENCE_PTR_TO @VIRTUAL06, @VIRTUAL0A
	MOVE_INT @VIRTUAL0A, @LOCAL00
.ELSE
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	DEREFERENCE_PTR_TO @VIRTUAL0A, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL00
.ENDIF
	JSL UNKNOWN_C240A4
	STZ ENEMY_PERFORMING_FINAL_ATTACK
.IF .DEFINED(JPN)
	LDY @LOCAL03
	STY CURRENT_ATTACKER
	LDX @LOCAL05
	STX CURRENT_TARGET
	MOVE_INT @LOCAL02, @VIRTUAL06
.ELSE
	LDX @LOCAL05
	STX CURRENT_ATTACKER
	LDY @LOCAL02
	STY CURRENT_TARGET
	MOVE_INT @LOCAL01, @VIRTUAL06
.ENDIF
	MOVE_INT @VIRTUAL06, BATTLER_TARGET_FLAGS
	LDA #0
	JSL FIX_ATTACKER_NAME
	JSL FIX_TARGET_NAME
	LDA SPECIAL_DEFEAT
	BNEL @UNKNOWN62
@UNKNOWN33:
	LDA SKIP_DEATH_TEXT_AND_CLEANUP
	BNEL @UNKNOWN62
	LOADPTR ENEMY_CONFIGURATION_TABLE, @VIRTUAL0A
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::death_text_ptr
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	DEREFERENCE_PTR_TO @VIRTUAL0A, @VIRTUAL06
	MOVE_INT @VIRTUAL06, @LOCAL00
	JSL DISPLAY_IN_BATTLE_TEXT
	LDA #.LOWORD(BATTLERS_TABLE)
	LDX #0
	STX @LOCAL07
	BRA @UNKNOWN36
@UNKNOWN35:
	TAX
	SEP #PROC_FLAGS::ACCUM8
	STZ a:battler::use_alt_spritemap,X
	CLC
	REP #PROC_FLAGS::ACCUM8
	ADC #.SIZEOF(battler)
	LDX @LOCAL07
	INX
	STX @LOCAL07
@UNKNOWN36:
	CPX #BATTLER_COUNT
	BCC @UNKNOWN35
	SEP #PROC_FLAGS::ACCUM8
	LDA #1
	LDX @VIRTUAL02
	STA a:battler::use_alt_spritemap,X
	REP #PROC_FLAGS::ACCUM8
	LDA #10
	JSL UNKNOWN_C2FAD8
	LDA #1
	STA @VIRTUAL04
	BRA @UNKNOWN38
@UNKNOWN37:
	LDA #31
	STA @LOCAL00
	TAY
	TAX
	STX @LOCAL05
	LDX @VIRTUAL02
	LDA a:battler::vram_sprite_index,X
	AND #$00FF
	ASL
	ASL
	ASL
	ASL
	CLC
	ADC @VIRTUAL04
	LDX @LOCAL05
	JSL UNKNOWN_C2FB35
	INC @VIRTUAL04
@UNKNOWN38:
	LDA @VIRTUAL04
	CMP #16
	BCC @UNKNOWN37
	LDA #SIXTH_OF_A_SECOND
	JSR WAIT
	LDA #20
	JSL UNKNOWN_C2FAD8
	LDA #1
	STA @VIRTUAL04
	BRA @UNKNOWN40
@UNKNOWN39:
	STZ_BADOPT @LOCAL00
.IF .DEFINED(JPN)
	TAY
	TAX
.ELSE
	LDY #0
	TYX
.ENDIF
	STX @LOCAL05
	LDX @VIRTUAL02
	LDA a:battler::vram_sprite_index,X
	AND #$00FF
	ASL
	ASL
	ASL
	ASL
	CLC
	ADC @VIRTUAL04
	LDX @LOCAL05
	JSL UNKNOWN_C2FB35
	INC @VIRTUAL04
@UNKNOWN40:
	LDA @VIRTUAL04
	CMP #16
	BCC @UNKNOWN39
	LDA #THIRD_OF_A_SECOND
	JSR WAIT
	SEP #PROC_FLAGS::ACCUM8
	LDA #STATUS_0::UNCONSCIOUS
	LDX @VIRTUAL02
	STA a:battler::afflictions + STATUS_GROUP::PERSISTENT_EASYHEAL,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::SHIELD,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::HOMESICKNESS,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::CONCENTRATION,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::STRANGENESS,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::TEMPORARY,X
	LDX @VIRTUAL02
	STZ a:battler::afflictions + STATUS_GROUP::PERSISTENT_HARDHEAL,X
	LDX @VIRTUAL02
	REP #PROC_FLAGS::ACCUM8
	STZ a:battler::hp_target,X
	LDX @VIRTUAL02
	LDA a:battler::id,X
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::death_type
	TAX
	LDA f:ENEMY_CONFIGURATION_TABLE,X
	AND #$00FF
	BEQL @UNKNOWN54
	LDX #.LOWORD(BATTLERS_TABLE) + (.SIZEOF(battler) * (FIRST_ENEMY_INDEX))
	LDY #FIRST_ENEMY_INDEX
	BRA @UNKNOWN44
@UNKNOWN42:
	LDA a:battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN43
	SEP #PROC_FLAGS::ACCUM8
	LDA #1
	STA a:battler::use_alt_spritemap,X
@UNKNOWN43:
	REP #PROC_FLAGS::ACCUM8
	TXA
	CLC
	ADC #.SIZEOF(battler)
	TAX
	INY
@UNKNOWN44:
	CPY #BATTLER_COUNT
	BCC @UNKNOWN42
	LDA #SFX::ENEMY_DEFEATED
	JSL PLAY_SOUND
	LDA #10
	JSL UNKNOWN_C2FAD8
	LDA #1
	STA @VIRTUAL04
	BRA @UNKNOWN47
@UNKNOWN45:
	LDA @VIRTUAL04
	AND #15
	BEQ @UNKNOWN46
	LDA #31
	STA @LOCAL00
	TAY
	TAX
	LDA @VIRTUAL04
	JSL UNKNOWN_C2FB35
@UNKNOWN46:
	INC @VIRTUAL04
@UNKNOWN47:
	LDA @VIRTUAL04
	CMP #64
	BCC @UNKNOWN45
	LDA #SIXTH_OF_A_SECOND
	JSR WAIT
	LDA #20
	JSL UNKNOWN_C2FAD8
	LDA #1
	STA @VIRTUAL04
	BRA @UNKNOWN50
@UNKNOWN48:
	LDA @VIRTUAL04
	AND #15
	BEQ @UNKNOWN49
	STZ_BADOPT @LOCAL00
.IF .DEFINED(JPN)
	TAY
	TAX
.ELSE
	LDY #0
	TYX
.ENDIF
	LDA @VIRTUAL04
	JSL UNKNOWN_C2FB35
@UNKNOWN49:
	INC @VIRTUAL04
@UNKNOWN50:
	LDA @VIRTUAL04
	CMP #64
	BCC @UNKNOWN48
	LDA #20
	JSR WAIT
	LDX #.LOWORD(BATTLERS_TABLE) + (.SIZEOF(battler) * 8)
	LDY #8
	BRA @UNKNOWN53
@UNKNOWN51:
	LDA a:battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN52
	SEP #PROC_FLAGS::ACCUM8
	LDA #STATUS_0::UNCONSCIOUS
	STA a:battler::afflictions + STATUS_GROUP::PERSISTENT_EASYHEAL,X
@UNKNOWN52:
	REP #PROC_FLAGS::ACCUM8
	TXA
	CLC
	ADC #.SIZEOF(battler)
	TAX
	INY
@UNKNOWN53:
	CPY #BATTLER_COUNT
	BCC @UNKNOWN51
	JSL UNKNOWN_C2F8F9
	LDA #2
	STA SPECIAL_DEFEAT
@UNKNOWN54:
	LDX @VIRTUAL02
	LDA a:battler::npc_id,X
	AND #$00FF
	CMP #ENEMY::TINY_LIL_GHOST
	BNEL @UNKNOWN62
	LDY #0
	STY @LOCAL07
	BRA @UNKNOWN58
@UNKNOWN56:
	TYA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN57
	LDA BATTLERS_TABLE+battler::npc_id,X
	AND #$00FF
	BNE @UNKNOWN57
	TXA
	CLC
	ADC #.LOWORD(BATTLERS_TABLE) + battler::afflictions
	TAX
	INX
	LDA __BSS_START__,X ; STATUS_GROUP::PERSISTENT_HARDHEAL
	AND #$00FF
	CMP #2
	BNE @UNKNOWN57
	SEP #PROC_FLAGS::ACCUM8
	LDA #0
	STA __BSS_START__,X
	BRA @UNKNOWN61
@UNKNOWN57:
	LDY @LOCAL07
	INY
	STY @LOCAL07
@UNKNOWN58:
	CPY #TOTAL_PARTY_COUNT
	BCC @UNKNOWN56
	BRA @UNKNOWN61
@UNKNOWN59:
	REP #PROC_FLAGS::ACCUM8
	TYA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN60
	LDA BATTLERS_TABLE+battler::npc_id,X
	AND #$00FF
	BNE @UNKNOWN60
	TXA
	CLC
	ADC #.LOWORD(BATTLERS_TABLE) + battler::afflictions
	TAX
	LDA a:STATUS_GROUP::PERSISTENT_HARDHEAL,X
	AND #$00FF
	CMP #STATUS_1::POSSESSED
	BNE @UNKNOWN60
	LDX #.LOWORD(BATTLERS_TABLE) + (.SIZEOF(battler) * 6)
	LDA #ENEMY::TINY_LIL_GHOST
	JSL BATTLE_INIT_ENEMY_STATS
	SEP #PROC_FLAGS::ACCUM8
	LDA #ENEMY::TINY_LIL_GHOST
	STA BATTLERS_TABLE+(TOTAL_PARTY_COUNT)*.SIZEOF(battler)+battler::npc_id
	LDA #1
	STA BATTLERS_TABLE+(TOTAL_PARTY_COUNT)*.SIZEOF(battler)+battler::has_taken_turn
@UNKNOWN60:
	LDY @LOCAL07
	INY
	STY @LOCAL07
@UNKNOWN61:
	LDY @LOCAL07
	CPY #TOTAL_PARTY_COUNT
	BCC @UNKNOWN59
@UNKNOWN62:
	REP #PROC_FLAGS::ACCUM8
	END_C_FUNCTION
