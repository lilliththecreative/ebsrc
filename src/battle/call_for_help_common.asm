
CALL_FOR_HELP_COMMON:
	BEGIN_C_FUNCTION
	STACK_RESERVE_VARS
	STACK_RESERVE_PARAM_INT16
	STACK_RESERVE_INT32
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	END_STACK_VARS
	STA @LOCAL0C
	LDX CURRENT_ATTACKER
	LDA a:battler::ally_or_enemy,X
	AND #$00FF
	BEQ @UNKNOWN2
	LDX CURRENT_ATTACKER
	LDA a:battler::current_action_argument,X
	AND #$00FF
	STA @LOCAL0B
	LOADPTR BTL_ENTRY_PTR_TABLE, @VIRTUAL0A
	LDA CURRENT_BATTLE_GROUP
	OPTIMIZED_MULT @VIRTUAL04, 8
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	DEREFERENCE_PTR_TO @VIRTUAL0A, @VIRTUAL06
	BRA @UNKNOWN1
@UNKNOWN0:
	LDY #$0001
	LDA [@VIRTUAL06],Y
	CMP @LOCAL0B
	BEQ @UNKNOWN4
	LDA #$0003
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
@UNKNOWN1:
	MOVE_INT @VIRTUAL06, @VIRTUAL0A
	LDA [@VIRTUAL0A]
	AND #$00FF
	CMP #$00FF
	BNE @UNKNOWN0
@UNKNOWN2:
	LDA @LOCAL0C
	BEQ @UNKNOWN3
	DISPLAY_BATTLE_TEXT_PTR MSG_BTL_TANEMAKI_NO
	JMP @UNKNOWN33
@UNKNOWN3:
	DISPLAY_BATTLE_TEXT_PTR MSG_BTL_NAKAMA_NO
	JMP @UNKNOWN33
@UNKNOWN4:
	LDX #.LOWORD(BATTLERS_TABLE)
	LDA #$0000
	STA @LOCAL0A
	LDY #$0008
	BRA @UNKNOWN7
@UNKNOWN5:
	LDA a:battler::consciousness,X
	AND #$00FF
	CMP #$0001
	BNE @UNKNOWN6
	LDA a:battler::afflictions + STATUS_GROUP::PERSISTENT_EASYHEAL,X
	AND #$00FF
	CMP #STATUS_0::UNCONSCIOUS
	BEQ @UNKNOWN6
	LDA a:battler::unknown76,X
	CMP @LOCAL0B
	BNE @UNKNOWN6
	LDA @LOCAL0A
	INC
	STA @LOCAL0A
@UNKNOWN6:
	TXA
	CLC
	ADC #.SIZEOF(battler)
	TAX
	INY
@UNKNOWN7:
	CPY #$0020
	BCC @UNKNOWN5
	LOADPTR ENEMY_CONFIGURATION_TABLE, @VIRTUAL06
	LDA @LOCAL0B
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	TAX
	STX @LOCAL09
	TXA
	CLC
	ADC #enemy_data::max_called
	MOVE_INTX @VIRTUAL06, @VIRTUAL0A
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	LDA [@VIRTUAL0A]
	AND #$00FF
	TAY
	STY @LOCAL08
	LDA @LOCAL0A
	STA @VIRTUAL02
	TYA
	SEC
	SBC @VIRTUAL02
	LDY #$00CD
	JSL MULT168
	LDY @LOCAL08
	JSL DIVISION16S_DIVISOR_POSITIVE
	SEP #PROC_FLAGS::ACCUM8
	JSR SUCCESS_255
	.A16
	CMP #$0000
	BEQL @UNKNOWN2
	LDX @LOCAL09
	TXA
	CLC
	ADC #enemy_data::battle_sprite
	MOVE_INTX @VIRTUAL06, @VIRTUAL0A
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	LDA [@VIRTUAL0A]
	STA @LOCAL08
	JSR GET_BATTLE_SPRITE_WIDTH
	OPTIMIZED_MULT @VIRTUAL04, 8
	CLC
	ADC #$0010
	STA @LOCAL07
	LDX @LOCAL09
	TXA
	CLC
	ADC #enemy_data::row
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	LDA [@VIRTUAL06]
	AND #$00FF
	STA @LOCAL06
	JSR UNKNOWN_C2BD13
	TAX
	STX @LOCAL05
	LDA @LOCAL08
	JSR GET_BATTLE_SPRITE_WIDTH
	STA @VIRTUAL02
	LDX @LOCAL05
	TXA
	CLC
	ADC @VIRTUAL02
	CMP #$0020
	BGTL @UNKNOWN21
	LDA #$0080
	STA @LOCAL05
	STA @LOCAL04
	STA @VIRTUAL04
	LDY @VIRTUAL04
	STY @LOCAL03
	LDX #.LOWORD(BATTLERS_TABLE) + (.SIZEOF(battler) * 8)
	STX @LOCAL02
	LDA #$0008
	STA @LOCAL09
	BRA @UNKNOWN16
@UNKNOWN10:
	LDA a:battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN15
	LDA a:battler::sprite,X
	JSR GET_BATTLE_SPRITE_WIDTH
	OPTIMIZED_MULT @VIRTUAL04, 8
	LSR
	STA @VIRTUAL02
	STA @LOCAL01
	LDX @LOCAL02
	LDA a:battler::row,X
	AND #$00FF
	CMP @LOCAL06
	BNE @UNKNOWN12
	LDA a:battler::sprite_x,X
	AND #$00FF
	SEC
	SBC @VIRTUAL02
	LDY @LOCAL03
	STY @VIRTUAL02
	CMP @VIRTUAL02
	BCS @UNKNOWN11
	TAY
	STY @LOCAL03
@UNKNOWN11:
	LDA @LOCAL01
	STA @VIRTUAL02
	LDA a:battler::sprite_x,X
	AND #$00FF
	CLC
	ADC @VIRTUAL02
	CMP @VIRTUAL04
	BLTEQ @UNKNOWN15
	STA @VIRTUAL04
	BRA @UNKNOWN15
@UNKNOWN12:
	LDA a:battler::sprite_x,X
	AND #$00FF
	SEC
	SBC @VIRTUAL02
	CMP @LOCAL04
	BCS @UNKNOWN13
	STA @LOCAL04
@UNKNOWN13:
	LDA a:battler::sprite_x,X
	AND #$00FF
	CLC
	ADC @VIRTUAL02
	CMP @LOCAL05
	BLTEQ @UNKNOWN15
	STA @LOCAL05
@UNKNOWN15:
	TXA
	CLC
	ADC #.SIZEOF(battler)
	TAX
	STX @LOCAL02
	INC @LOCAL09
@UNKNOWN16:
	LDA @LOCAL09
	CMP #$0020
	BCCL @UNKNOWN10
	LDA @VIRTUAL04
	SEC
	SBC #$0080
	PHA
	LDY @LOCAL03
	STY @VIRTUAL02
	LDA #$0080
	SEC
	SBC @VIRTUAL02
	PLX
	STX @VIRTUAL02
	CMP @VIRTUAL02
	BCS @UNKNOWN18
	CPY @LOCAL07
	BLTEQ @UNKNOWN19
	LDA @LOCAL07
	LSR
	STA @VIRTUAL02
	TYA
	SEC
	SBC @VIRTUAL02
	TAY
	STY @LOCAL0A
	JMP @UNKNOWN25
@UNKNOWN18:
	.A16
	LDA @VIRTUAL04
	CLC
	ADC @LOCAL07
	CMP #$0100
	BCS @UNKNOWN19
	LDA @LOCAL07
	LSR
	STA @VIRTUAL02
	LDA @VIRTUAL04
	CLC
	ADC @VIRTUAL02
	TAY
	STY @LOCAL0A
	JMP @UNKNOWN25
@UNKNOWN19:
	LDA #$0001
	SEC
	SBC @LOCAL06
	STA @LOCAL06
	LDA @LOCAL05
	SEC
	SBC #$0080
	STA @VIRTUAL02
	LDA #$0080
	SEC
	SBC @LOCAL04
	CMP @VIRTUAL02
	BCS @UNKNOWN20
	LDA @LOCAL04
	CMP @LOCAL07
	BLTEQ @UNKNOWN21
	LDA @LOCAL07
	LSR
	STA @VIRTUAL02
	LDA @LOCAL04
	SEC
	SBC @VIRTUAL02
	TAY
	STY @LOCAL0A
	JMP @UNKNOWN25
@UNKNOWN20:
	LDA @LOCAL05
	CLC
	ADC @LOCAL07
	CMP #$0100
	BCS @UNKNOWN21
	LDA @LOCAL07
	LSR
	CLC
	ADC @LOCAL05
	TAY
	STY @LOCAL0A
	JMP @UNKNOWN25
@UNKNOWN21:
	LDX #.LOWORD(BATTLERS_TABLE) + (.SIZEOF(battler) * 8)
	STX @LOCAL01
	LDA #$0008
	STA @VIRTUAL02
	BRA @UNKNOWN24
@UNKNOWN22:
	TXA
	CLC
	ADC #battler::consciousness
	TAY
	STY @LOCAL02
	LDA __BSS_START__,Y
	AND #$00FF
	CMP #$0001
	BNE @UNKNOWN23
	LDA a:battler::afflictions + STATUS_GROUP::PERSISTENT_EASYHEAL,X
	AND #$00FF
	CMP #STATUS_0::UNCONSCIOUS
	BNE @UNKNOWN23
	LDA @LOCAL08
	JSR GET_BATTLE_SPRITE_WIDTH
	STA @VIRTUAL04
	LDX @LOCAL01
	LDA a:battler::sprite,X
	JSR GET_BATTLE_SPRITE_WIDTH
	PHA
	LDA @VIRTUAL04
	PLY
	STY @VIRTUAL04
	CMP @VIRTUAL04
	BNE @UNKNOWN23
	SEP #PROC_FLAGS::ACCUM8
	LDA #$0000
	LDY @LOCAL02 ;battler::consciousness
	STA __BSS_START__,Y
	LDX @LOCAL01
	REP #PROC_FLAGS::ACCUM8
	LDA a:battler::sprite_x,X
	AND #$00FF
	TAY
	STY @LOCAL0A
	LDA a:battler::row,X
	AND #$00FF
	STA @LOCAL06
	BRA @UNKNOWN25
@UNKNOWN23:
	LDX @LOCAL01
	TXA
	CLC
	ADC #.SIZEOF(battler)
	TAX
	STX @LOCAL01
	INC @VIRTUAL02
@UNKNOWN24:
	LDA @VIRTUAL02
	CMP #BATTLER_COUNT
	BCC @UNKNOWN22
	JMP @UNKNOWN2
@UNKNOWN25:
	JSR UNKNOWN_C2BD13
	TAX
	STX @LOCAL09
	LDA @LOCAL08
	JSR GET_BATTLE_SPRITE_WIDTH
	STA @VIRTUAL02
	LDX @LOCAL09
	TXA
	CLC
	ADC @VIRTUAL02
	CMP #$0020
	BGTL @UNKNOWN2
	LDA #.LOWORD(BATTLERS_TABLE) + (.SIZEOF(battler) * 8)
	STA @LOCAL09
	LDX #$0008
	STX @LOCAL08
	BRA @UNKNOWN28
@UNKNOWN27:
	TAX
	LDA a:battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN29
	LDA @LOCAL09
	CLC
	ADC #.SIZEOF(battler)
	STA @LOCAL09
	LDX @LOCAL08
	INX
	STX @LOCAL08
@UNKNOWN28:
	CPX #$0020
	BCC @UNKNOWN27
@UNKNOWN29:
	LDA @LOCAL09
	STA CURRENT_TARGET
	LDX CURRENT_TARGET
	LDA @LOCAL0B
	JSL BATTLE_INIT_ENEMY_STATS
	LDY @LOCAL0A
	TYA
	SEP #PROC_FLAGS::ACCUM8
	LDX CURRENT_TARGET
	STA a:battler::sprite_x,X
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL06
	SEP #PROC_FLAGS::ACCUM8
	LDX CURRENT_TARGET
	STA a:battler::row,X
	LDX CURRENT_TARGET
	REP #PROC_FLAGS::ACCUM8
	LDA a:battler::row,X
	AND #$00FF
	BEQ @UNKNOWN30
	SEP #PROC_FLAGS::ACCUM8
	LDA #$0080
	LDX CURRENT_TARGET
	STA a:battler::sprite_y,X
	BRA @UNKNOWN31
@UNKNOWN30:
	SEP #PROC_FLAGS::ACCUM8
	LDA #$0090
	LDX CURRENT_TARGET
	STA a:battler::sprite_y,X
@UNKNOWN31:
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL0B
	JSR UNKNOWN_C2F09F
	SEP #PROC_FLAGS::ACCUM8
	LDX CURRENT_TARGET
	STA a:battler::vram_sprite_index,X
	LDA #$0001
	LDX CURRENT_TARGET
	STA a:battler::has_taken_turn,X
	JSL FIX_TARGET_NAME
	.A16
	LDA @LOCAL0C
	BEQ @UNKNOWN32
	DISPLAY_BATTLE_TEXT_PTR MSG_BTL_TANEMAKI_HAETA
	BRA @UNKNOWN33
@UNKNOWN32:
	DISPLAY_BATTLE_TEXT_PTR MSG_BTL_NAKAMA_KITA
@UNKNOWN33:
	END_C_FUNCTION
