
FIND_TARGETTABLE_NPC:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_RETURN_INT16 ;bool
	END_STACK_VARS
	JSL RAND
	AND #$0003
	BNE @UNKNOWN0
	LDA #$0000
	BRA @UNKNOWN7
@UNKNOWN0:
	LDA #$0000
	STA @LOCAL01
	BRA @UNKNOWN6
@UNKNOWN1:
	LDA_STRUCT_MEMBER GAME_STATE, game_state::party_members
	AND #$00FF
	TAY
	STY @LOCAL00
	CPY #PARTY_MEMBER::POKEY
	BCC @INVALID_PARTY_TARGET
	TYA
	ASL
	TAX
	LDA f:NPC_AI_TABLE,X
	AND #$00FF
	AND #NPC_FLAGS::UNTARGETTABLE
	BEQ @INVALID_PARTY_TARGET
	LDA #$0000
	STA @LOCAL01
	BRA @UNKNOWN4
@UNKNOWN2:
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN3
	LDY @LOCAL00
	STY $02
	LDA BATTLERS_TABLE+battler::npc_id,X
	AND #$00FF
	CMP $02
	BNE @UNKNOWN3
	LDA @LOCAL01
	INC
	BRA @UNKNOWN7
@UNKNOWN3:
	LDA @LOCAL01
	INC
	STA @LOCAL01
@UNKNOWN4:
	CMP #.SIZEOF(game_state::party_members)
	BCC @UNKNOWN2
@INVALID_PARTY_TARGET:
	LDA @LOCAL01
	INC
	STA @LOCAL01
@UNKNOWN6:
	CMP #.SIZEOF(game_state::party_members)
	BCC @UNKNOWN1
	LDA #$0000
@UNKNOWN7:
	END_C_FUNCTION
