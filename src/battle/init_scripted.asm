
INIT_BATTLE_SCRIPTED:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_PARAM_INT16 ;int character
	STACK_RESERVE_RETURN_INT16
	END_STACK_VARS
	STA @LOCAL01
	STA CURRENT_BATTLE_GROUP
	LOADPTR BTL_ENTRY_PTR_TABLE, @VIRTUAL0A
	LDA @LOCAL01
	ASL
	ASL
	ASL
	CLC
	ADC @VIRTUAL0A
	STA @VIRTUAL0A
	DEREFERENCE_PTR_TO @VIRTUAL0A, @VIRTUAL06
	STZ ENEMIES_IN_BATTLE
	BRA @UNKNOWN2
@UNKNOWN0:
	LDA ENEMIES_IN_BATTLE
	ASL
	TAX
	LDY #1
	LDA [@VIRTUAL06],Y
	STA ENEMIES_IN_BATTLE_IDS,X
	INC ENEMIES_IN_BATTLE
@UNKNOWN1:
	LDA @LOCAL00
	TAX
	DEC
	STA @LOCAL00
	CPX #0
	BNE @UNKNOWN0
	LDA #3
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
@UNKNOWN2:
	MOVE_INT @VIRTUAL06, @VIRTUAL0A
	LDA [@VIRTUAL0A]
	AND #$00FF
	STA @LOCAL00
	CMP #$00FF
	BNE @UNKNOWN1
	LDA #$FFFF
	STA BATTLE_MODE
	JSL BATTLE_SWIRL_SEQUENCE
	BRA @UNKNOWN4
@UNKNOWN3:
	JSL WAIT_UNTIL_NEXT_FRAME
	JSL UNKNOWN_C4A7B0
@UNKNOWN4:
	JSL UNKNOWN_C2E9C8
	CMP #0
	BNE @UNKNOWN3
	JSL INIT_BATTLE_COMMON
	TAX
	STX @LOCAL01
	LDA PSI_TELEPORT_DESTINATION
	BNE @UNKNOWN6
	CPX #0
	BEQ @UNKNOWN5
	LDA #1
	BRA @RETURN
@UNKNOWN5:
	JSL RELOAD_MAP
	LDX #1
	TXA
	JSL FADE_IN
	BRA @UNKNOWN7
@UNKNOWN6:
	JSL TELEPORT_MAINLOOP
	LDX @LOCAL01
	BEQ @UNKNOWN7
	LDA #1
	BRA @RETURN
@UNKNOWN7:
	JSL UNKNOWN_C3EE4D
	LDA CURRENT_BATTLE_GROUP
	CMP #ENEMY_GROUP::BOSS_START
	BCS @UNKNOWN8
	LDA #120
	STA PLAYER_INTANGIBILITY_FRAMES
@UNKNOWN8:
	LDA #0
@RETURN:
	END_C_FUNCTION
