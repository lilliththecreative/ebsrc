
FIND_TARGETTABLE_NPC: ;$C23F6C
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8 | PROC_FLAGS::CARRY
	RESERVE_STACK_SPACE_CLOBBER 18
	JSL RAND
	AND #$0003
	BNE @UNKNOWN0
	LDA #$0000
	BRA @UNKNOWN7
@UNKNOWN0:
	LDA #$0000
	STA $10
	BRA @UNKNOWN6
@UNKNOWN1:
	CLC
	ADC #.LOWORD(GAME_STATE)
	TAX
	LDA a:game_state::party_members,X
	AND #$00FF
	TAY
	STY $0E
	CPY #PARTY_MEMBER::POKEY
	BCC @INVALID_PARTY_TARGET
	TYA
	ASL
	TAX
	LDA f:NPC_AI_TABLE,X
	AND #$00FF
	AND #NPC_FLAGS::UNTARGETTABLE
	BEQ @INVALID_PARTY_TARGET
	LDA #$0000
	STA $10
	BRA @UNKNOWN4
@UNKNOWN2:
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN3
	LDY $0E
	STY $02
	LDA BATTLERS_TABLE+battler::npc_id,X
	AND #$00FF
	CMP $02
	BNE @UNKNOWN3
	LDA $10
	INC
	BRA @UNKNOWN7
@UNKNOWN3:
	LDA $10
	INC
	STA $10
@UNKNOWN4:
	CMP #.SIZEOF(game_state::party_members)
	BCC @UNKNOWN2
@INVALID_PARTY_TARGET:
	LDA $10
	INC
	STA $10
@UNKNOWN6:
	CMP #.SIZEOF(game_state::party_members)
	BCC @UNKNOWN1
	LDA #$0000
@UNKNOWN7:
	PLD
	RTL
