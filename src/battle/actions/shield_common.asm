
SHIELDS_COMMON:
	BEGIN_C_FUNCTION
	STACK_RESERVE_VARS
	STACK_RESERVE_INT16
	STACK_RESERVE_PARAM_INT16
	STACK_RESERVE_PARAM_INT16
	END_STACK_VARS
	TXY
	STA @LOCAL00
	CLC
	ADC #battler::afflictions + STATUS_GROUP::SHIELD
	TAX
	STY @VIRTUAL02
	LDA __BSS_START__,X
	AND #$00FF
	CMP @VIRTUAL02
	BNE @UNKNOWN3
	LDA @LOCAL00
	CLC
	ADC #battler::shield_hp
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X
	INC
	INC
	INC
	STA __BSS_START__,X
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	CLC
	SBC #8
	BRANCHLTEQS @UNKNOWN2
	SEP #PROC_FLAGS::ACCUM8
	LDA #8
	STA __BSS_START__,X
@UNKNOWN2:
	REP #PROC_FLAGS::ACCUM8
	LDA #1
	BRA @UNKNOWN4
@UNKNOWN3:
	TYA
	SEP #PROC_FLAGS::ACCUM8
	STA __BSS_START__,X
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL00
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA #3
	STA a:battler::shield_hp,X
	REP #PROC_FLAGS::ACCUM8
	LDA #0
@UNKNOWN4:
	END_C_FUNCTION
