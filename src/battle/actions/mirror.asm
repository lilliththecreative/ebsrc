
BTLACT_MIRROR: ;$C2B0A1
	REP #PROC_FLAGS::ACCUM8 | PROC_FLAGS::INDEX8 | PROC_FLAGS::CARRY
	RESERVE_STACK_SPACE_CLOBBER 26
	LDX CURRENT_TARGET
	LDA a:battler::id,X
	TAX
	STX $18
	LDX CURRENT_TARGET
	LDA a:battler::ally_or_enemy,X
	AND #$00FF
	BEQL @UNKNOWN2
	LDX CURRENT_TARGET
	LDA a:battler::npc_id,X
	AND #$00FF
	BNEL @UNKNOWN2
	LDA #100
	JSR RAND_LIMIT
	STA $16
	LDX $18
	TXA
	LDY #.SIZEOF(enemy_data)
	JSL MULT168
	CLC
	ADC #enemy_data::mirror_success
	TAX
	LDA f:ENEMY_CONFIGURATION_TABLE,X
	AND #$00FF
	STA $02
	LDA $16
	CMP $02
	BCS @UNKNOWN2
	LDX $18
	STX MIRROR_ENEMY
	LDA #DEFAULT_MIRROR_TURN_COUNT
	STA MIRROR_TURN_TIMER
	LDA CURRENT_ATTACKER
	PROMOTENEARPTRA $06
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT $06, $0E
	LDX #.SIZEOF(battler)
	LDA #.LOWORD(MIRROR_BATTLER_BACKUP)
	JSL MEMCPY16
	LDA CURRENT_ATTACKER
	PROMOTENEARPTRA $06
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT $06, $0E
	LDA CURRENT_TARGET
	PROMOTENEARPTRA $06
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT $06, $12
	JSL COPY_MIRROR_DATA
	DISPLAY_BATTLE_TEXT_PTR MSG_BTL_METAMORPHOSE_OK
	BRA @UNKNOWN3
@UNKNOWN2:
	DISPLAY_BATTLE_TEXT_PTR MSG_BTL_METAMORPHOSE_NG
@UNKNOWN3:
	PLD
	RTL
