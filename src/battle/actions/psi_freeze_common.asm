
PSI_FREEZE_COMMON:
	BEGIN_C_FUNCTION
	STACK_RESERVE_VARS
	STACK_RESERVE_INT32
	STACK_RESERVE_INT16 "TMPDAMAGE"
	STACK_RESERVE_INT16 "DAMAGEDONE"
	STACK_RESERVE_PARAM_INT16 ;int
	END_STACK_VARS
	TAX
	STX @DAMAGEDONE
	JSR FAIL_ATTACK_ON_NPCS
	CMP #0
	BNE @RETURN
	JSR PSI_SHIELD_NULLIFY
	CMP #0
	BNE @RETURN
	LDX @DAMAGEDONE
	TXA
	JSR TWENTY_FIVE_PERCENT_VARIANCE
	STA @TMPDAMAGE
	LDX CURRENT_TARGET
	LDA a:battler::freeze_resist,X
	AND #$00FF
	TAX
	LDA @TMPDAMAGE
	JSR CALC_RESIST_DAMAGE
	TAX
	STX @DAMAGEDONE
	LDX CURRENT_TARGET
	LDA a:battler::afflictions + STATUS_GROUP::PERSISTENT_EASYHEAL,X
	AND #$00FF
	CMP #1
	BEQ @WEAKEN_SHIELD
	LDX @DAMAGEDONE
	BEQ @WEAKEN_SHIELD
	LDA #100
	JSR RAND_LIMIT
	CMP #25
	BCS @WEAKEN_SHIELD
	LDY #STATUS_2::SOLIDIFIED
	LDX #STATUS_GROUP::TEMPORARY
	LDA CURRENT_TARGET
	JSR INFLICT_STATUS_BATTLE
	CMP #0
	BEQ @WEAKEN_SHIELD
	LOADPTR MSG_BTL_KOORI_ON, @LOCAL00
	JSL DISPLAY_IN_BATTLE_TEXT
@WEAKEN_SHIELD:
	JSR WEAKEN_SHIELD
@RETURN:
	END_C_FUNCTION
