
UNKNOWN_C2F121:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_INT32
	STACK_RESERVE_INT16
.IF .DEFINED(USA)
	STACK_RESERVE_INT16 "LOCALEB"
.ENDIF
	STACK_RESERVE_INT8 "LOCAL03"
	STACK_RESERVE_INT16 "LOCAL04"
	STACK_RESERVE_INT16 "LOCAL05"
	STACK_RESERVE_INT16 "LOCAL06"
	STACK_RESERVE_INT16 "LOCAL07"
	STACK_RESERVE_INT16 "LOCAL08"
	STACK_RESERVE_INT16 "LOCAL09"
	STACK_RESERVE_INT16 "LOCAL0A"
	STACK_RESERVE_INT16 "LOCAL0B"
	STACK_RESERVE_RETURN_INT16
	END_STACK_VARS
.IF .DEFINED(JPN) ;wonder why the allocation is so different here?
	@LOCALEB_1 := @LOCAL04
	@LOCALEB_2 := @LOCAL05
	@LOCAL04ALT := @LOCAL09
	@LOCAL04ALT2 := @LOCAL0A
	@LOCAL05ALT := @LOCAL01
	@LOCAL05ALT2 := @LOCAL04
	@LOCAL0AALT := @LOCAL07
.ELSE
	@LOCALEB_1 := @LOCALEB
	@LOCALEB_2 := @LOCALEB
	@LOCAL04ALT := @LOCAL04
	@LOCAL04ALT2 := @LOCAL04
	@LOCAL05ALT := @LOCAL05
	@LOCAL05ALT2 := @LOCAL05
	@LOCAL0AALT := @LOCAL0A
.ENDIF
	STZ BATTLE_SPRITE_ROW_WIDTH+2
	STZ BATTLE_SPRITE_ROW_WIDTH
	LDX #8
	STX @LOCAL0B
	JMP @UNKNOWN10
@UNKNOWN0:
	TXA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAY
	STY @LOCAL0A
	LDA BATTLERS_TABLE+battler::consciousness,Y
	AND #$00FF
	BEQL @UNKNOWN9
	LDA BATTLERS_TABLE+battler::ally_or_enemy,Y
	AND #$00FF
	CMP #1
	BNEL @UNKNOWN9
	LDA BATTLERS_TABLE,Y
	JSR UNKNOWN_C2F09F
	SEP #PROC_FLAGS::ACCUM8
	LDY @LOCAL0A
	STA BATTLERS_TABLE+battler::vram_sprite_index,Y
	REP #PROC_FLAGS::ACCUM8
	LDA BATTLERS_TABLE+battler::row,Y
	AND #$00FF
	STA @LOCAL09
	LDA BATTLERS_TABLE+battler::sprite,Y
	JSR GET_BATTLE_SPRITE_WIDTH
	STA @VIRTUAL02
	LDA @LOCAL09
	ASL
	TAX
	LDA BATTLE_SPRITE_ROW_WIDTH,X
	BEQ @UNKNOWN3
	INC @VIRTUAL02
@UNKNOWN3:
	LDA @LOCAL09
	ASL
	CLC
	ADC #.LOWORD(BATTLE_SPRITE_ROW_WIDTH)
	TAY
	LDA __BSS_START__,Y
	CLC
	ADC @VIRTUAL02
	CMP #30
	BGT @UNKNOWN5
	STA __BSS_START__,Y
	BRA @UNKNOWN9
@UNKNOWN5:
	LDA #1
	SEC
	SBC @LOCAL09
	STA @LOCAL0A
	LDX @LOCAL0B
	TXA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	LDA BATTLERS_TABLE+battler::sprite,X
	JSR GET_BATTLE_SPRITE_WIDTH
	STA @VIRTUAL02
	LDA @LOCAL0A
	ASL
	TAX
	LDA BATTLE_SPRITE_ROW_WIDTH,X
	BEQ @UNKNOWN6
	INC @VIRTUAL02
@UNKNOWN6:
	LDA @LOCAL0A
	ASL
	CLC
	ADC #.LOWORD(BATTLE_SPRITE_ROW_WIDTH)
	TAY
	STY @LOCAL08
	LDA __BSS_START__,Y
	CLC
	ADC @VIRTUAL02
	CMP #30
	BGT @UNKNOWN8
	LDX @LOCAL0B
	TXA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	LDA @LOCAL0A
	SEP #PROC_FLAGS::ACCUM8
	STA BATTLERS_TABLE+battler::row,X
	LDY @LOCAL08
	REP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,Y
	CLC
	ADC @VIRTUAL02
	STA __BSS_START__,Y
	BRA @UNKNOWN9
@UNKNOWN8:
	LDA #0
	JMP @UNKNOWN60
@UNKNOWN9:
	LDX @LOCAL0B
	INX
	STX @LOCAL0B
@UNKNOWN10:
	CPX #BATTLER_COUNT
	BCCL @UNKNOWN0
	;TODO: why 8?
	LDA BATTLERS_TABLE+8*.SIZEOF(battler)+16
	AND #$00FF
	STA @LOCAL0A
	LDA #32
	STA @LOCAL07
	STA @LOCAL06
	LDX #8
	STX @LOCAL08
	JMP @UNKNOWN21
@UNKNOWN12:
	TXA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAY
	STY @LOCAL09
	LDA BATTLERS_TABLE+battler::consciousness,Y
	AND #$00FF
	BEQL @UNKNOWN20
	LDA BATTLERS_TABLE+battler::ally_or_enemy,Y
	AND #$00FF
	CMP #1
	BNEL @UNKNOWN20
	LDA BATTLERS_TABLE+16,Y
	AND #$00FF
	CMP @LOCAL0A
	BNEL @UNKNOWN20
	LDA BATTLERS_TABLE+battler::sprite,Y
	JSR GET_BATTLE_SPRITE_WIDTH
	LSR
	STA @LOCAL05
	LDA @LOCAL06
	CMP @LOCAL07
	BNE @UNKNOWN17
	LDA @LOCAL06
	SEP #PROC_FLAGS::ACCUM8
	LDY @LOCAL09
	STA BATTLERS_TABLE+battler::sprite_x,Y
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL06
	SEC
	SBC @LOCAL05
	STA @LOCAL06
	LDA @LOCAL07
	CLC
	ADC @LOCAL05
	STA @LOCAL07
	JSR RAND_LONG
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	AND #$0001
	BEQ @UNKNOWN16
	LDA @LOCAL06
	STA @VIRTUAL04
	STA @LOCAL04
	JMP @UNKNOWN20
@UNKNOWN16:
	LDA @LOCAL07
	STA @VIRTUAL04
	STA @LOCAL04
	JMP @UNKNOWN20
@UNKNOWN17:
	LDA #32
	SEC
	SBC @LOCAL06
	STA @LOCAL09
	LDA @LOCAL07
	SEC
	SBC #32
	STA @VIRTUAL02
	LDA @LOCAL09
	CMP @VIRTUAL02
	BCC @UNKNOWN18
	CMP @VIRTUAL02
	BNE @UNKNOWN19
	JSR RAND_LONG
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	AND #$0001
	BEQ @UNKNOWN19
@UNKNOWN18:
	LDA @LOCAL05
	SEP #PROC_FLAGS::ACCUM8
	STA @VIRTUAL00
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL06
	SEP #PROC_FLAGS::ACCUM8
	SEC
	SBC @VIRTUAL00
	DEC
	STA @LOCAL03
	LDX @LOCAL08
	REP #PROC_FLAGS::ACCUM8
	TXA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA @LOCAL03
	STA BATTLERS_TABLE+battler::sprite_x,X
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	SEC
	SBC @LOCAL05
	STA @LOCAL06
	BRA @UNKNOWN20
@UNKNOWN19:
	LDA @LOCAL05
	SEP #PROC_FLAGS::ACCUM8
	STA @VIRTUAL00
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL07
	SEP #PROC_FLAGS::ACCUM8
	CLC
	ADC @VIRTUAL00
	INC
	STA @LOCAL03
	LDX @LOCAL08
	REP #PROC_FLAGS::ACCUM8
	TXA
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA @LOCAL03
	STA BATTLERS_TABLE+battler::sprite_x,X
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	CLC
	ADC @LOCAL05
	STA @LOCAL07
@UNKNOWN20:
	LDX @LOCAL08
	INX
	STX @LOCAL08
@UNKNOWN21:
	CPX #32
	BCCL @UNKNOWN12
	LDA @LOCAL04
	STA @VIRTUAL04
	LDY @VIRTUAL04
	STY @LOCAL0B
	TYX
	STX @LOCALEB_1
	LDA #8
	STA @VIRTUAL02
	STA @LOCAL08
	JMP @UNKNOWN32
@UNKNOWN23:
	LDA @VIRTUAL02
	LDY #.SIZEOF(battler)
	JSL MULT168
	STA @VIRTUAL04
	LDX @VIRTUAL04
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQL @UNKNOWN31
	LDX @VIRTUAL04
	LDA BATTLERS_TABLE+battler::ally_or_enemy,X
	AND #$00FF
	CMP #1
	BNEL @UNKNOWN31
	LDX @VIRTUAL04
	LDA BATTLERS_TABLE+16,X
	AND #$00FF
	CMP @LOCAL0A
	BEQL @UNKNOWN31
	LDX @VIRTUAL04
	LDA BATTLERS_TABLE+battler::sprite,X
	JSR GET_BATTLE_SPRITE_WIDTH
	LSR
	STA @LOCAL01
	LDY @LOCAL0B
	STY @VIRTUAL02
	LDX @LOCALEB_1
	TXA
	CMP @VIRTUAL02
	BNE @UNKNOWN27
	TXA
	SEP #PROC_FLAGS::ACCUM8
	LDX @VIRTUAL04
	STA BATTLERS_TABLE+battler::sprite_x,X
	LDX @LOCALEB_1
	REP #PROC_FLAGS::ACCUM8
	TXA
	SEC
	SBC @LOCAL01
	TAX
	STX @LOCALEB_1
	TYA
	CLC
	ADC @LOCAL01
	TAY
	STY @LOCAL0B
	JMP @UNKNOWN31
@UNKNOWN27:
	CPY #32
	BLTEQ @UNKNOWN30
	CPX #32
	BGT @UNKNOWN29
	STX @VIRTUAL04
	LDA #32
	SEC
	SBC @VIRTUAL04
	STA @LOCAL04ALT
	TYA
	SEC
	SBC #32
	STA @VIRTUAL04
	LDA @LOCAL04ALT
	CMP @VIRTUAL04
	BCC @UNKNOWN29
	CMP @VIRTUAL04
	BNE @UNKNOWN30
	JSR RAND_LONG
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	AND #$0001
	BEQ @UNKNOWN30
@UNKNOWN29:
	LDA @LOCAL01
	SEP #PROC_FLAGS::ACCUM8
	STA @VIRTUAL00
	LDX @LOCALEB_1
	REP #PROC_FLAGS::ACCUM8
	TXA
	SEP #PROC_FLAGS::ACCUM8
	SEC
	SBC @VIRTUAL00
	DEC
	STA @LOCAL03
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL08
	STA @VIRTUAL02
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA @LOCAL03
	STA BATTLERS_TABLE+battler::sprite_x,X
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	SEC
	SBC @LOCAL01
	TAX
	STX @LOCALEB_1
	BRA @UNKNOWN31
@UNKNOWN30:
	LDA @LOCAL01
	SEP #PROC_FLAGS::ACCUM8
	STA @VIRTUAL00
	LDY @LOCAL0B
	REP #PROC_FLAGS::ACCUM8
	TYA
	SEP #PROC_FLAGS::ACCUM8
	CLC
	ADC @VIRTUAL00
	INC
	STA @LOCAL03
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL08
	STA @VIRTUAL02
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA @LOCAL03
	STA BATTLERS_TABLE+battler::sprite_x,X
	REP #PROC_FLAGS::ACCUM8
	AND #$00FF
	CLC
	ADC @LOCAL01
	TAY
	STY @LOCAL0B
@UNKNOWN31:
	LDA @LOCAL08
	STA @VIRTUAL02
	INC @VIRTUAL02
	LDA @VIRTUAL02
	STA @LOCAL08
@UNKNOWN32:
	LDA @VIRTUAL02
	CMP #32
	BCCL @UNKNOWN23
	LDA @LOCAL0A
	CMP #1
	BNE @UNKNOWN37
	LDY @LOCAL0B
	STY @VIRTUAL02
	LDX @LOCALEB_1
	TXA
	CMP @VIRTUAL02
	BNE @UNKNOWN37
	LDA #8
	STA @VIRTUAL02
	BRA @UNKNOWN36
@UNKNOWN34:
	LDA @VIRTUAL02
	LDY #.SIZEOF(battler)
	JSL MULT168
	STA @LOCAL04ALT2
	TAX
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN35
	LDA @LOCAL04ALT2
	TAX
	LDA BATTLERS_TABLE+battler::ally_or_enemy,X
	AND #$00FF
	CMP #1
	BNE @UNKNOWN35
	LDA @LOCAL04ALT2
	TAX
	SEP #PROC_FLAGS::ACCUM8
	STZ BATTLERS_TABLE+battler::row,X
@UNKNOWN35:
	REP #PROC_FLAGS::ACCUM8
	INC @VIRTUAL02
@UNKNOWN36:
	LDA @VIRTUAL02
	CMP #32
	BCC @UNKNOWN34
@UNKNOWN37:
	LDX @LOCALEB_1
	CPX @LOCAL06
	BCS @UNKNOWN38
	STX @LOCAL06
@UNKNOWN38:
	LDY @LOCAL0B
	CPY @LOCAL07
	BLTEQ @UNKNOWN39
	STY @LOCAL07
@UNKNOWN39:
	LDA @LOCAL06
	CLC
	ADC @LOCAL07
	LSR
	STA @VIRTUAL02
	LDA #32
	SEC
	SBC @VIRTUAL02
	SEC
	SBC #16
	TAY
	STY @LOCAL06
	LDA #8
	STA @LOCALEB_2
	BRA @UNKNOWN43
@UNKNOWN40:
	LDY #.SIZEOF(battler)
	JSL MULT168
	TAX
	STX @LOCAL05ALT
	LDA BATTLERS_TABLE+battler::consciousness,X
	AND #$00FF
	BEQ @UNKNOWN42
	LDA BATTLERS_TABLE+battler::ally_or_enemy,X
	AND #$00FF
	CMP #1
	BNE @UNKNOWN42
	TXA
	CLC
	ADC #.LOWORD(BATTLERS_TABLE) + battler::sprite_x
	STA @VIRTUAL02
	LDY @LOCAL06
	SEP #PROC_FLAGS::INDEX8
	STY @VIRTUAL00
	REP #PROC_FLAGS::INDEX8
	LDX @VIRTUAL02
	SEP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X
	CLC
	ADC @VIRTUAL00
	ASL
	ASL
	ASL
	LDX @VIRTUAL02
	STA __BSS_START__,X
	LDX @LOCAL05ALT
	REP #PROC_FLAGS::ACCUM8
	LDA BATTLERS_TABLE+battler::row,X
	AND #$00FF
	BEQ @UNKNOWN41
	SEP #PROC_FLAGS::ACCUM8
	LDA #128
	STA BATTLERS_TABLE+69,X
	BRA @UNKNOWN42
@UNKNOWN41:
	SEP #PROC_FLAGS::ACCUM8
	LDA #144
	STA BATTLERS_TABLE+69,X
@UNKNOWN42:
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCALEB_2
	INC
	STA @LOCALEB_2
@UNKNOWN43:
	CMP #BATTLER_COUNT
	BCC @UNKNOWN40
	LDA CURRENT_BATTLE_GROUP
	CMP #ENEMY_GROUP::UNKNOWN_475
	BNE @UNKNOWN44
	SEP #PROC_FLAGS::ACCUM8
	LDA #128
	STA BATTLERS_TABLE+8*.SIZEOF(battler)+battler::sprite_x
	STA BATTLERS_TABLE+8*.SIZEOF(battler)+69
	LDA #200
	STA BATTLERS_TABLE+9*.SIZEOF(battler)+battler::sprite_x
	LDA #144
	STA BATTLERS_TABLE+9*.SIZEOF(battler)+69
@UNKNOWN44:
	REP #PROC_FLAGS::ACCUM8
	STZ @LOCAL09
	LDA #0
	STA @VIRTUAL04
	JMP @UNKNOWN57
@UNKNOWN45:
	.I16
	LDA @VIRTUAL04
.IF .DEFINED(USA)
	REP #PROC_FLAGS::INDEX8
.ENDIF
	LDY #.SIZEOF(battler)
	JSL MULT168
	CLC
	ADC #.LOWORD(BATTLERS_TABLE) + (.SIZEOF(battler) * 8)
	TAY
	STY @LOCAL05ALT2
	LDA @VIRTUAL04
	INC
	STA @LOCAL06
	JMP @UNKNOWN55
@UNKNOWN46:
	.I16
	LDA @LOCAL06
.IF .DEFINED(USA)
	REP #PROC_FLAGS::INDEX8
.ENDIF
	LDY #.SIZEOF(battler)
	JSL MULT168
	CLC
	ADC #.LOWORD(BATTLERS_TABLE)+8*.SIZEOF(battler)
	STA @LOCAL0AALT
	LDY @LOCAL05ALT2
	LDA __BSS_START__,Y
	CMP (@LOCAL0AALT)
	BNEL @UNKNOWN54
	SEP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__+11,Y
	LDY #11
	CMP (@LOCAL0AALT),Y
	BCS @UNKNOWN48
	LDY @LOCAL05ALT2
	LDA __BSS_START__+69,Y
	STA @VIRTUAL00
	LDY #69
	LDA (@LOCAL0AALT),Y
	STA @LOCAL03
	STA @VIRTUAL01
	LDA @VIRTUAL00
	CMP @VIRTUAL01
	BCC @UNKNOWN53
	LDA @LOCAL03
	PHA
	LDA @VIRTUAL00
	SEP #PROC_FLAGS::INDEX8
	PLX
	STX @VIRTUAL00
	CMP @VIRTUAL00
	BNE @UNKNOWN48
	REP #PROC_FLAGS::INDEX8
	LDY @LOCAL05ALT2
	LDA __BSS_START__+68,Y
	LDY #68
	CMP (@LOCAL0AALT),Y
	BGT @UNKNOWN53
@UNKNOWN48:
	REP #PROC_FLAGS::INDEX8
	LDY @LOCAL05ALT2
	LDA __BSS_START__+11,Y
	LDY #11
	CMP (@LOCAL0AALT),Y
.IF .DEFINED(JPN)
	BCS @UNKNOWN50
.ELSE
	BGT @UNKNOWN50
.ENDIF
	JMP @UNKNOWN54
@UNKNOWN50:
	LDY @LOCAL05ALT2
	LDA __BSS_START__+69,Y
	STA @VIRTUAL00
	LDY #69
	LDA (@LOCAL0AALT),Y
	STA @LOCAL03
	STA @VIRTUAL01
	LDA @VIRTUAL00
	CMP @VIRTUAL01
	BGT @UNKNOWN53
	LDA @LOCAL03
	PHA
	LDA @VIRTUAL00
	SEP #PROC_FLAGS::INDEX8
	PLX
	STX @VIRTUAL00
	CMP @VIRTUAL00
	BNEL @UNKNOWN54
	REP #PROC_FLAGS::INDEX8
	LDY @LOCAL05ALT2
	LDA a:battler::sprite_x,Y
	LDY #68
	CMP (@LOCAL0AALT),Y
	BCC @UNKNOWN53
	JMP @UNKNOWN54
@UNKNOWN53:
	REP #PROC_FLAGS::ACCUM8
	LDA #1
	STA @LOCAL09
	LDY @LOCAL05ALT2
	TYA
	CLC
	ADC #11
	TAX
	STX @LOCALEB_2
	LDA __BSS_START__,X
	AND #$00FF
	STA @LOCAL01
	LDA @LOCAL0AALT
	CLC
	ADC #11
	STA @VIRTUAL02
	LDX @VIRTUAL02
	SEP #PROC_FLAGS::ACCUM8
	LDA __BSS_START__,X
	LDX @LOCALEB_2
	STA __BSS_START__,X
	REP #PROC_FLAGS::ACCUM8
	LDA @LOCAL01
	SEP #PROC_FLAGS::ACCUM8
	LDX @VIRTUAL02
	STA __BSS_START__,X
	STA @VIRTUAL00
	LDX @LOCALEB_2
	LDA __BSS_START__,X
	CMP @VIRTUAL00
	BLTEQ @UNKNOWN54
	REP #PROC_FLAGS::ACCUM8
	LDA #.LOWORD(BATTLERS_TABLE) + ((BATTLER_COUNT - 1) * .SIZEOF(battler))
	STA @VIRTUAL02
	TYA
	PROMOTENEARPTRA @VIRTUAL06
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDX #.SIZEOF(battler)
	LDA @VIRTUAL02
	JSL MEMCPY16
	LDA @LOCAL0AALT
	PROMOTENEARPTRA @VIRTUAL06
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDX #.SIZEOF(battler)
	LDY @LOCAL05ALT2
	TYA
	JSL MEMCPY16
	LDA @VIRTUAL02
	PROMOTENEARPTRA @VIRTUAL06
	REP #PROC_FLAGS::ACCUM8
	MOVE_INT @VIRTUAL06, @LOCAL00
	LDX #.SIZEOF(battler)
	LDA @LOCAL0AALT
	JSL MEMCPY16
@UNKNOWN54:
	REP #PROC_FLAGS::ACCUM8
	INC @LOCAL06
@UNKNOWN55:
	LDA ENEMIES_IN_BATTLE
	CMP @LOCAL06
	BGTL @UNKNOWN46
	INC @VIRTUAL04
@UNKNOWN57:
	LDA ENEMIES_IN_BATTLE
	DEC
	STA @VIRTUAL02
	LDA @VIRTUAL04
	CMP @VIRTUAL02
	BCCL @UNKNOWN45
	LDA @LOCAL09
	BNEL @UNKNOWN44
	SEP #PROC_FLAGS::ACCUM8
	STZ_BADOPT @LOCAL00
	REP #PROC_FLAGS::INDEX8
	LDX #.SIZEOF(battler)
	REP #PROC_FLAGS::ACCUM8
	LDA #.LOWORD(BATTLERS_TABLE) + 31 * .SIZEOF(battler)
	JSL MEMSET16
	LDA #0
@UNKNOWN60:
	END_C_FUNCTION
