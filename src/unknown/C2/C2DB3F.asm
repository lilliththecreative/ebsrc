
UNKNOWN_C2DB3F:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	END_STACK_VARS
	LDA ENABLE_BACKGROUND_DARKENING
	BEQ @UNKNOWN3
	LDA BACKGROUND_BRIGHTNESS
	SEC
	SBC #$0555
	STA BACKGROUND_BRIGHTNESS
	STORE_INT1632 @VIRTUAL0A
	MOVE_INT_CONSTANT $00006000, @VIRTUAL06
	CLC
	CMP32ALT @VIRTUAL06, @VIRTUAL0A
	BRANCHLTEQS @UNKNOWN2
	LDA #$6000
	STA BACKGROUND_BRIGHTNESS
	STZ ENABLE_BACKGROUND_DARKENING
@UNKNOWN2:
	SEP #PROC_FLAGS::INDEX8
	LDY #$0008
	LDA BACKGROUND_BRIGHTNESS
	JSL ASR8_UNKNOWN1
	JSR UNKNOWN_C2E08E
@UNKNOWN3:
	LDA REFLECT_FLASH_DURATION
	BEQ @UNKNOWN5
	LDA REFLECT_FLASH_DURATION
	DEC
	STA REFLECT_FLASH_DURATION
	AND #$0002
	BEQ @UNKNOWN4
	LDA #$FFFF
	JSR UNKNOWN_C2E08E
	BRA @UNKNOWN5
@UNKNOWN4:
	LDA #$0100
	JSR UNKNOWN_C2E08E
@UNKNOWN5:
	LDA GREEN_BACKGROUND_FLASH_DURATION
	BEQ @UNKNOWN10
	STZ PALETTES
	LDA GREEN_BACKGROUND_FLASH_DURATION
	CMP #3
	BEQ @UNKNOWN6
	CMP #2
	BEQ @UNKNOWN7
	BRA @UNKNOWN8
@UNKNOWN6:
	LDA #$03E0
	STA PALETTES
@UNKNOWN7:
	LDA #$0018
	JSL UNKNOWN_C0856B
@UNKNOWN8:
	LDA GREEN_BACKGROUND_FLASH_DURATION
	DEC
	STA GREEN_BACKGROUND_FLASH_DURATION
	AND #$0002
	BEQ @UNKNOWN9
	LDA #0
	JSR UNKNOWN_C2E08E
	BRA @UNKNOWN10
@UNKNOWN9:
	LDA #$0100
	JSR UNKNOWN_C2E08E
@UNKNOWN10:
	LDA VERTICAL_SHAKE_DURATION
	BNE @UNKNOWN11
	STZ SCREEN_EFFECT_VERTICAL_OFFSET
	BRA @UNKNOWN12
@UNKNOWN11:
	LDA #1*SECOND
	SEC
	SBC VERTICAL_SHAKE_DURATION
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA f:UNKNOWN_C4A591,X
	REP #PROC_FLAGS::ACCUM8
	SEC
	AND #$00FF
	SBC #$0080
	EOR #$FF80
	STA SCREEN_EFFECT_VERTICAL_OFFSET
	LDX VERTICAL_SHAKE_DURATION
	DEX
	STX VERTICAL_SHAKE_DURATION
	BNE @UNKNOWN12
	LDA VERTICAL_SHAKE_HOLD_DURATION
	BEQ @UNKNOWN12
	DEC VERTICAL_SHAKE_HOLD_DURATION
	LDA #1*SIXTH_OF_A_SECOND
	STA VERTICAL_SHAKE_DURATION
@UNKNOWN12:
	.I16
	STZ SCREEN_EFFECT_HORIZONTAL_OFFSET
	LDA WOBBLE_DURATION
	BEQ @UNKNOWN13
	LDY #6*FIFTHS_OF_A_SECOND
	LDA WOBBLE_DURATION
	JSL MODULUS16
	DEC WOBBLE_DURATION
	LDY #72
	XBA
	AND #$FF00
	JSL DIVISION16S_DIVISOR_POSITIVE
	.I16
	TAX
	LDY #$0100
	SEP #PROC_FLAGS::ACCUM8
	LDA f:SINE_LOOKUP_TABLE,X
	REP #PROC_FLAGS::ACCUM8
	SEC
	AND #$00FF
	SBC #$0080
	EOR #$FF80
	ASL
	ASL
	ASL
	ASL
	ASL
	ASL
	JSL DIVISION16
	STA SCREEN_EFFECT_HORIZONTAL_OFFSET
@UNKNOWN13:
	LDA SHAKE_DURATION
	BEQ @UNKNOWN17
	LDA SHAKE_DURATION
	AND #$0003
	DEC SHAKE_DURATION
	CMP #0
	BEQ @UNKNOWN14
	CMP #2
	BEQ @UNKNOWN14
	CMP #1
	BEQ @UNKNOWN15
	CMP #3
	BEQ @UNKNOWN16
	BRA @UNKNOWN17
@UNKNOWN14:
	STZ SCREEN_EFFECT_HORIZONTAL_OFFSET
	BRA @UNKNOWN17
@UNKNOWN15:
	LDA #2
	STA SCREEN_EFFECT_HORIZONTAL_OFFSET
	BRA @UNKNOWN17
@UNKNOWN16:
	LDA #$FFFE
	STA SCREEN_EFFECT_HORIZONTAL_OFFSET
@UNKNOWN17:
	LDA LOADED_BG_DATA_LAYER1 + loaded_bg_data::bitdepth
	AND #$00FF
	CMP #2
	BNE @UNKNOWN18
	LDA SCREEN_EFFECT_HORIZONTAL_OFFSET
	STA BG1_X_POS
	LDA SCREEN_EFFECT_VERTICAL_OFFSET
	STA BG1_Y_POS
	BRA @UNKNOWN19
@UNKNOWN18:
	LDA BATTLE_MODE_FLAG
	BEQ @UNKNOWN19
	LDA SCREEN_EFFECT_HORIZONTAL_OFFSET
	STA BG3_X_POS
	LDA SCREEN_EFFECT_VERTICAL_OFFSET
	STA BG3_Y_POS
@UNKNOWN19:
	LDA SCREEN_EFFECT_MINIMUM_WAIT_FRAMES
	BEQ @UNKNOWN20
	DEC SCREEN_EFFECT_MINIMUM_WAIT_FRAMES
@UNKNOWN20:
	LDA BATTLE_MODE_FLAG
	BEQ @UNKNOWN21
	JSL UNKNOWN_C2F8F9
@UNKNOWN21:
	LDX #0
	LDA #.LOWORD(LOADED_BG_DATA_LAYER1)
	JSL GENERATE_BATTLEBG_FRAME
	LDY #.LOWORD(LOADED_BG_DATA_LAYER2)
	LDA __BSS_START__,Y
	AND #$00FF
	BEQ @UNKNOWN22
	LDX #1
	TYA
	JSL GENERATE_BATTLEBG_FRAME
@UNKNOWN22:
	JSL UNKNOWN_C2E6B6
	LDA RED_FLASH_DURATION
	BEQ @UNKNOWN24
	LDA RED_FLASH_DURATION
	DEC
	STA RED_FLASH_DURATION
	LDY #12
	JSL DIVISION16S_DIVISOR_POSITIVE
	AND #$0001
	BEQ @UNKNOWN23
	LDY #4
	LDX #0
	LDA #31
	JSL SET_COLDATA
	LDX #$003F
	LDA #0
	JSL SET_COLOUR_ADDSUB_MODE
	BRA @UNKNOWN24
@UNKNOWN23:
	LDY #0
	TYX
	TYA
	JSL SET_COLDATA
	LDA CURRENT_LAYER_CONFIG
	JSL UNKNOWN_C0AFCD
@UNKNOWN24:
	LDA GREEN_FLASH_DURATION
	BEQ @UNKNOWN26
	LDA GREEN_FLASH_DURATION
	DEC
	STA GREEN_FLASH_DURATION
	LDY #12
	JSL DIVISION16S_DIVISOR_POSITIVE
	AND #$0001
	BEQ @UNKNOWN25
	LDY #4
	LDX #31
	LDA #0
	JSL SET_COLDATA
	LDX #$003F
	LDA #0
	JSL SET_COLOUR_ADDSUB_MODE
	BRA @UNKNOWN26
@UNKNOWN25:
	LDY #0
	TYX
	TYA
	JSL SET_COLDATA
	LDA CURRENT_LAYER_CONFIG
	JSL UNKNOWN_C0AFCD
@UNKNOWN26:
	LDA HP_PP_BOX_BLINK_DURATION
	BEQ @UNKNOWN28
	LDA HP_PP_BOX_BLINK_DURATION
	DEC
	STA HP_PP_BOX_BLINK_DURATION
	LDY #3
	JSL DIVISION16S_DIVISOR_POSITIVE
	AND #$0001
	BEQ @UNKNOWN27
	LDA HP_PP_BOX_BLINK_TARGET
	JSL UNDRAW_HP_PP_WINDOW
	BRA @UNKNOWN28
@UNKNOWN27:
	LDA HP_PP_BOX_BLINK_TARGET
	JSL UNKNOWN_C207B6
@UNKNOWN28:
	JSL UNKNOWN_C4A7B0
	JSL UNKNOWN_C2FD99
	LDA LETTERBOX_EFFECT_ENDING
	BEQ @UNKNOWN33
	LDA LETTERBOX_TOP_END
	BEQ @UNKNOWN33
	LDA LETTERBOX_EFFECT_ENDING_TOP
	CMP #$03BB
	BCS @UNKNOWN29
	STZ LETTERBOX_EFFECT_ENDING_TOP
	LDA #224
	STA LETTERBOX_EFFECT_ENDING_BOTTOM
	STZ LETTERBOX_EFFECT_ENDING
	BRA @UNKNOWN30
@UNKNOWN29:
	LDA LETTERBOX_EFFECT_ENDING_TOP
	SEC
	SBC #$03BB
	STA LETTERBOX_EFFECT_ENDING_TOP
	LDA LETTERBOX_EFFECT_ENDING_BOTTOM
	CLC
	ADC #$03BB
	STA LETTERBOX_EFFECT_ENDING_BOTTOM
@UNKNOWN30:
	SEP #PROC_FLAGS::INDEX8
	LDY #8
	LDA LETTERBOX_EFFECT_ENDING_TOP
	JSL ASR8_UNKNOWN1
	CMP LETTERBOX_TOP_END
	BCS @UNKNOWN31
	STA LETTERBOX_TOP_END
@UNKNOWN31:
	LDY #8
	LDA LETTERBOX_EFFECT_ENDING_BOTTOM
	JSL ASR8_UNKNOWN1
	CMP LETTERBOX_BOTTOM_START
	BLTEQ @UNKNOWN32
	STA LETTERBOX_BOTTOM_START
@UNKNOWN32:
	JSL UNKNOWN_C2D0AC
@UNKNOWN33:
	END_C_FUNCTION
