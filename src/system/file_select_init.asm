
FILE_SELECT_INIT:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_INT32
	STACK_RESERVE_INT32
	END_STACK_VARS
	JSL UNKNOWN_C08726
	JSL UNKNOWN_C0927C
	JSL OAM_CLEAR
	JSL UPDATE_SCREEN
	JSL UNKNOWN_C01A86
	LDX #0
	LDA #$8000
	JSL ALLOC_SPRITE_MEM
	JSL INITIALIZE_MISC_OBJECT_DATA
	JSL OVERWORLD_SETUP_VRAM
	JSL UNKNOWN_C432B1
	JSL UNKNOWN_C005E7
	LOADPTR SPRITE_GROUP_PALETTES, @LOCAL00
	LDX #BPP4PALETTE_SIZE * 8
	LDA #.LOWORD(PALETTES) + BPP4PALETTE_SIZE * 8
	JSL MEMCPY16
	JSL UNKNOWN_C200D9
	LOADPTR BUFFER, @VIRTUAL06
	LDA #0
	STA [@VIRTUAL06]
	COPY_TO_VRAM1P @VIRTUAL06, VRAM::TEXT_LAYER_TILEMAP, $800, 3
	.A16
	LOADPTR TEXT_WINDOW_GFX, @LOCAL00
	MOVE_INT @VIRTUAL06, @LOCAL01
	JSL DECOMP
	.A16
	.IF .DEFINED(JPN)
		COPY_TO_VRAM1P @VIRTUAL06, VRAM::TEXT_LAYER_TILES, $3800, 0
	.ELSE
		LOADPTR BUFFER + $2000, @LOCAL00
		LOADPTR BUFFER + $1000, @LOCAL01
		LDA #$2A00
		JSL MEMCPY24
		LDA #1
		JSL UNKNOWN_C44963
	.ENDIF
	.A16
	LOADPTR TEXT_WINDOW_FLAVOUR_PALETTES, @LOCAL00
	LDX #BPP4PALETTE_SIZE * 2
	LDA #.LOWORD(PALETTES)
	JSL MEMCPY16
	SEP #PROC_FLAGS::ACCUM8
	LDA #PALETTE_UPLOAD::FULL
	STA PALETTE_UPLOAD_MODE
	LDX #0
	REP #PROC_FLAGS::ACCUM8
	LDA #BATTLEBG_LAYER::FILE_SELECT
	JSL LOAD_BACKGROUND_ANIMATION
	LDA #23
	STA ENTITY_ALLOCATION_MIN_SLOT
	LDA #24
	STA ENTITY_ALLOCATION_MAX_SLOT
	LDY #0
	TYX
	LDA #EVENT_SCRIPT::EVENT_787
	JSL INIT_ENTITY
	SEP #PROC_FLAGS::ACCUM8
	LDA #$16
	STA TM_MIRROR
	REP #PROC_FLAGS::ACCUM8
	STZ BG2_Y_POS
	STZ BG1_Y_POS
	STZ BG2_X_POS
	STZ BG1_X_POS
	JSL OAM_CLEAR
	JSL UPDATE_SCREEN
	LDX #1
	TXA
	JSL FADE_IN
	JSL UNKNOWN_C1FF6B
	LDY #0
	LDX #1
	TXA
	JSL FADE_OUT_WITH_MOSAIC
	LDA #$17
	JSL UNKNOWN_C09C35
	SEP #PROC_FLAGS::ACCUM8
	LDA #$17
	STA TM_MIRROR
	REP #PROC_FLAGS::ACCUM8
	LDA GAME_STATE+game_state::sound_setting
	AND #$00FF
	DEC
	JSL UNKNOWN_C4FD18
	PLD
	RTS
