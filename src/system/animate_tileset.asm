
ANIMATE_TILESET:
	BEGIN_C_FUNCTION_FAR
	STACK_RESERVE_VARS
	STACK_RESERVE_INT32
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	STACK_RESERVE_INT16
	END_STACK_VARS
	LDA #.LOWORD(OVERWORLD_TILESET_ANIM)
	STA @LOCAL03
	STZ @LOCAL02
	JMP @UNKNOWN4
@UNKNOWN0:
	LDA @LOCAL03
	CLC
	ADC #overworld_tileset_anim::frames_until_update
	TAX
	LDA __BSS_START__,X
	DEC
	STA __BSS_START__,X
	BNEL @UNKNOWN3
	LDY #overworld_tileset_anim::frame_delay
	LDA (@LOCAL03),Y
	STA __BSS_START__,X
	LDA @LOCAL03
	CLC
	ADC #overworld_tileset_anim::destination_address2
	TAX
	LDA __BSS_START__,X
	CMP (@LOCAL03) ;overworld_tileset_anim::unknown0
	BNE @UNKNOWN2
	LDA #0
	STA __BSS_START__,X
	LDY #overworld_tileset_anim::source_offset
	LDA (@LOCAL03),Y
	LDY #overworld_tileset_anim::source_offset2
	STA (@LOCAL03),Y
@UNKNOWN2:
	LDA @LOCAL03
	STA @VIRTUAL04
	INC @VIRTUAL04
	INC @VIRTUAL04
	INC @VIRTUAL04
	INC @VIRTUAL04
	LDA @LOCAL03 ;overworld_tileset_anim::copy_size
	CLC
	ADC #overworld_tileset_anim::source_offset2
	STA @VIRTUAL02
	STA @LOCAL01
	LOADPTR ANIMATED_TILESET_BUFFER, @VIRTUAL06
	LDX @VIRTUAL02
	LDA __BSS_START__,X
	CLC
	ADC @VIRTUAL06
	STA @VIRTUAL06
	STA @LOCAL00
	LDA @VIRTUAL06+2
	STA @LOCAL00+2
	LDY #overworld_tileset_anim::destination_address
	LDA (@LOCAL03),Y
	TAY
	LDX @VIRTUAL04
	LDA __BSS_START__,X
	TAX
	SEP #PROC_FLAGS::ACCUM8
	LDA #0
	JSL PREPARE_VRAM_COPY
	.A16
	LDX @VIRTUAL04
	LDA __BSS_START__,X
	PHA
	LDX @VIRTUAL02
	LDA __BSS_START__,X
	PLY
	STY @VIRTUAL02
	CLC
	ADC @VIRTUAL02
	LDX @LOCAL01
	STX @VIRTUAL02
	STA __BSS_START__,X
	LDA @LOCAL03
	CLC
	ADC #overworld_tileset_anim::destination_address2
	TAX
	LDA __BSS_START__,X
	INC
	STA __BSS_START__,X
@UNKNOWN3:
	LDA @LOCAL03
	CLC
	ADC #.SIZEOF(overworld_tileset_anim)
	STA @LOCAL03
	INC @LOCAL02
@UNKNOWN4:
	LDA LOADED_ANIMATED_TILE_COUNT
	CMP @LOCAL02
	BGTL @UNKNOWN0
	END_C_FUNCTION
